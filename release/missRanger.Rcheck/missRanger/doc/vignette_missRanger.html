<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Michael Mayer" />

<meta name="date" content="2019-06-30" />

<title>Using missRanger</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' || rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#header {
text-align: center;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; }  code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Using missRanger</h1>
<h4 class="author">Michael Mayer</h4>
<h4 class="date">2019-06-30</h4>



<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>The aim of this vignette is to introduce the R package <code>missRanger</code> for imputation of missing values and to explain how to use it for multiple imputation.</p>
<p><code>missRanger</code> uses the <code>ranger</code> package [1] to do fast missing value imputation by chained random forest. As such, it can be used as an alternative to <code>missForest</code>, a beautiful algorithm introduced by Stekhoven and Buehlmann in [2]. Basically, each variable is imputed by predictions from a random forest using all other variables as covariables. <code>missRanger</code> iterates multiple times over all variables until the average out-of-bag prediction error of the models stops to improve.</p>
<p>Why should you consider <code>missRanger</code>?</p>
<ul>
<li><p>It is fast.</p></li>
<li><p>It is flexible and intuitive to apply: E.g. calling <code>missRanger(data, . ~ 1)</code> would impute all variables univariately, <code>missRanger(data, Species ~ Sepal.Width)</code> would use <code>Sepal.Width</code> to impute <code>Species</code>.</p></li>
<li><p>It can deal with most realistic variable types, even dates and times without destroying the original data structure.</p></li>
<li><p>It combines random forest imputation with predictive mean matching. This generates realistic variability and avoids “new” values like 0.3334 in a 0-1 coded variable. Like this, <code>missRanger</code> can be used for realistic multiple imputation scenarios, see e.g. [4] for the statistical background.</p></li>
</ul>
<p>In the examples below, we will meet two functions from the <code>missRanger</code> package:</p>
<ul>
<li><p><code>generateNA</code>: To replace values in a data set by missing values.</p></li>
<li><p><code>missRanger</code>: To impute missing values in a data frame.</p></li>
</ul>
</div>
<div id="installation" class="section level2">
<h2>Installation</h2>
<p>From CRAN:</p>
<pre><code>install.packages(&quot;missRanger&quot;)</code></pre>
<p>Latest version from github:</p>
<pre><code>library(devtools)
install_github(&quot;mayer79/missRanger/release/missRanger&quot;)</code></pre>
</div>
<div id="examples" class="section level2">
<h2>Examples</h2>
<p>We first generate a data set with about 20% missing values per column and fill them again by <code>missRanger</code>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">library</span>(missRanger)</a>
<a class="sourceLine" id="cb3-2" title="2"><span class="kw">set.seed</span>(<span class="dv">84553</span>)</a>
<a class="sourceLine" id="cb3-3" title="3"></a>
<a class="sourceLine" id="cb3-4" title="4"><span class="kw">head</span>(iris)</a>
<a class="sourceLine" id="cb3-5" title="5"><span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span></a>
<a class="sourceLine" id="cb3-6" title="6"><span class="co">#&gt; 1          5.1         3.5          1.4         0.2  setosa</span></a>
<a class="sourceLine" id="cb3-7" title="7"><span class="co">#&gt; 2          4.9         3.0          1.4         0.2  setosa</span></a>
<a class="sourceLine" id="cb3-8" title="8"><span class="co">#&gt; 3          4.7         3.2          1.3         0.2  setosa</span></a>
<a class="sourceLine" id="cb3-9" title="9"><span class="co">#&gt; 4          4.6         3.1          1.5         0.2  setosa</span></a>
<a class="sourceLine" id="cb3-10" title="10"><span class="co">#&gt; 5          5.0         3.6          1.4         0.2  setosa</span></a>
<a class="sourceLine" id="cb3-11" title="11"><span class="co">#&gt; 6          5.4         3.9          1.7         0.4  setosa</span></a>
<a class="sourceLine" id="cb3-12" title="12"></a>
<a class="sourceLine" id="cb3-13" title="13"><span class="co"># Generate data with missing values in all columns</span></a>
<a class="sourceLine" id="cb3-14" title="14"><span class="kw">head</span>(irisWithNA &lt;-<span class="st"> </span><span class="kw">generateNA</span>(iris, <span class="dt">p =</span> <span class="fl">0.2</span>))</a>
<a class="sourceLine" id="cb3-15" title="15"><span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span></a>
<a class="sourceLine" id="cb3-16" title="16"><span class="co">#&gt; 1          5.1         3.5           NA         0.2  setosa</span></a>
<a class="sourceLine" id="cb3-17" title="17"><span class="co">#&gt; 2          4.9         3.0          1.4          NA  setosa</span></a>
<a class="sourceLine" id="cb3-18" title="18"><span class="co">#&gt; 3          4.7         3.2          1.3         0.2  setosa</span></a>
<a class="sourceLine" id="cb3-19" title="19"><span class="co">#&gt; 4           NA          NA           NA         0.2  setosa</span></a>
<a class="sourceLine" id="cb3-20" title="20"><span class="co">#&gt; 5          5.0         3.6          1.4          NA  setosa</span></a>
<a class="sourceLine" id="cb3-21" title="21"><span class="co">#&gt; 6          5.4         3.9           NA         0.4  setosa</span></a>
<a class="sourceLine" id="cb3-22" title="22"> </a>
<a class="sourceLine" id="cb3-23" title="23"><span class="co"># Impute missing values with missRanger</span></a>
<a class="sourceLine" id="cb3-24" title="24"><span class="kw">head</span>(irisImputed &lt;-<span class="st"> </span><span class="kw">missRanger</span>(irisWithNA, <span class="dt">num.trees =</span> <span class="dv">100</span>))</a>
<a class="sourceLine" id="cb3-25" title="25"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb3-26" title="26"><span class="co">#&gt; Missing value imputation by random forests</span></a>
<a class="sourceLine" id="cb3-27" title="27"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb3-28" title="28"><span class="co">#&gt;   Variables to impute:       Sepal.Length, Sepal.Width, Petal.Length, Petal.Width, Species</span></a>
<a class="sourceLine" id="cb3-29" title="29"><span class="co">#&gt;   Variables used to impute:  Sepal.Length, Sepal.Width, Petal.Length, Petal.Width, Species</span></a>
<a class="sourceLine" id="cb3-30" title="30"><span class="co">#&gt; iter 1:  .....</span></a>
<a class="sourceLine" id="cb3-31" title="31"><span class="co">#&gt; iter 2:  .....</span></a>
<a class="sourceLine" id="cb3-32" title="32"><span class="co">#&gt; iter 3:  .....</span></a>
<a class="sourceLine" id="cb3-33" title="33"><span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span></a>
<a class="sourceLine" id="cb3-34" title="34"><span class="co">#&gt; 1     5.100000    3.500000     1.503583   0.2000000  setosa</span></a>
<a class="sourceLine" id="cb3-35" title="35"><span class="co">#&gt; 2     4.900000    3.000000     1.400000   0.2845833  setosa</span></a>
<a class="sourceLine" id="cb3-36" title="36"><span class="co">#&gt; 3     4.700000    3.200000     1.300000   0.2000000  setosa</span></a>
<a class="sourceLine" id="cb3-37" title="37"><span class="co">#&gt; 4     5.673567    3.273117     2.505867   0.2000000  setosa</span></a>
<a class="sourceLine" id="cb3-38" title="38"><span class="co">#&gt; 5     5.000000    3.600000     1.400000   0.1914333  setosa</span></a>
<a class="sourceLine" id="cb3-39" title="39"><span class="co">#&gt; 6     5.400000    3.900000     1.509900   0.4000000  setosa</span></a></code></pre></div>
<p>It worked! Unfortunately, the new values look somewhat unnatural due to different rounding. If we would like to avoid this, we just set the <code>pmm.k</code> argument to a positive number. All imputations done during the process are then combined with a predictive mean matching (PMM) step, leading to more natural imputations and improved distributional properties of the resulting values:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">head</span>(irisImputed &lt;-<span class="st"> </span><span class="kw">missRanger</span>(irisWithNA, <span class="dt">pmm.k =</span> <span class="dv">3</span>, <span class="dt">num.trees =</span> <span class="dv">100</span>))</a>
<a class="sourceLine" id="cb4-2" title="2"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-3" title="3"><span class="co">#&gt; Missing value imputation by random forests</span></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-5" title="5"><span class="co">#&gt;   Variables to impute:       Sepal.Length, Sepal.Width, Petal.Length, Petal.Width, Species</span></a>
<a class="sourceLine" id="cb4-6" title="6"><span class="co">#&gt;   Variables used to impute:  Sepal.Length, Sepal.Width, Petal.Length, Petal.Width, Species</span></a>
<a class="sourceLine" id="cb4-7" title="7"><span class="co">#&gt; iter 1:  .....</span></a>
<a class="sourceLine" id="cb4-8" title="8"><span class="co">#&gt; iter 2:  .....</span></a>
<a class="sourceLine" id="cb4-9" title="9"><span class="co">#&gt; iter 3:  .....</span></a>
<a class="sourceLine" id="cb4-10" title="10"><span class="co">#&gt; iter 4:  .....</span></a>
<a class="sourceLine" id="cb4-11" title="11"><span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span></a>
<a class="sourceLine" id="cb4-12" title="12"><span class="co">#&gt; 1          5.1         3.5          1.4         0.2  setosa</span></a>
<a class="sourceLine" id="cb4-13" title="13"><span class="co">#&gt; 2          4.9         3.0          1.4         0.2  setosa</span></a>
<a class="sourceLine" id="cb4-14" title="14"><span class="co">#&gt; 3          4.7         3.2          1.3         0.2  setosa</span></a>
<a class="sourceLine" id="cb4-15" title="15"><span class="co">#&gt; 4          5.8         3.1          1.5         0.2  setosa</span></a>
<a class="sourceLine" id="cb4-16" title="16"><span class="co">#&gt; 5          5.0         3.6          1.4         0.2  setosa</span></a>
<a class="sourceLine" id="cb4-17" title="17"><span class="co">#&gt; 6          5.4         3.9          1.4         0.4  setosa</span></a></code></pre></div>
<p>Note that <code>missRanger</code> offers a <code>...</code> argument to pass options to <code>ranger</code>, e.g. <code>num.trees</code> or <code>min.node.size</code>. How would we use its “extra trees” variant with 50 trees?</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">head</span>(irisImputed_et &lt;-<span class="st"> </span><span class="kw">missRanger</span>(irisWithNA, <span class="dt">pmm.k =</span> <span class="dv">3</span>, <span class="dt">splitrule =</span> <span class="st">&quot;extratrees&quot;</span>, <span class="dt">num.trees =</span> <span class="dv">50</span>))</a>
<a class="sourceLine" id="cb5-2" title="2"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb5-3" title="3"><span class="co">#&gt; Missing value imputation by random forests</span></a>
<a class="sourceLine" id="cb5-4" title="4"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb5-5" title="5"><span class="co">#&gt;   Variables to impute:       Sepal.Length, Sepal.Width, Petal.Length, Petal.Width, Species</span></a>
<a class="sourceLine" id="cb5-6" title="6"><span class="co">#&gt;   Variables used to impute:  Sepal.Length, Sepal.Width, Petal.Length, Petal.Width, Species</span></a>
<a class="sourceLine" id="cb5-7" title="7"><span class="co">#&gt; iter 1:  .....</span></a>
<a class="sourceLine" id="cb5-8" title="8"><span class="co">#&gt; iter 2:  .....</span></a>
<a class="sourceLine" id="cb5-9" title="9"><span class="co">#&gt; iter 3:  .....</span></a>
<a class="sourceLine" id="cb5-10" title="10"><span class="co">#&gt; iter 4:  .....</span></a>
<a class="sourceLine" id="cb5-11" title="11"><span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span></a>
<a class="sourceLine" id="cb5-12" title="12"><span class="co">#&gt; 1          5.1         3.5          1.3         0.2  setosa</span></a>
<a class="sourceLine" id="cb5-13" title="13"><span class="co">#&gt; 2          4.9         3.0          1.4         0.2  setosa</span></a>
<a class="sourceLine" id="cb5-14" title="14"><span class="co">#&gt; 3          4.7         3.2          1.3         0.2  setosa</span></a>
<a class="sourceLine" id="cb5-15" title="15"><span class="co">#&gt; 4          4.8         2.7          1.3         0.2  setosa</span></a>
<a class="sourceLine" id="cb5-16" title="16"><span class="co">#&gt; 5          5.0         3.6          1.4         0.4  setosa</span></a>
<a class="sourceLine" id="cb5-17" title="17"><span class="co">#&gt; 6          5.4         3.9          1.3         0.4  setosa</span></a></code></pre></div>
<p>It is as simple!</p>
<p>Further note that <code>missRanger</code> does not rely on <code>tidyverse</code> but you can embed it into a <code>dplyr</code> pipeline (without <code>group_by</code>). Make sure to set <code>verbose = 0</code> in order to prevent messages.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="kw">require</span>(dplyr)</a>
<a class="sourceLine" id="cb6-2" title="2"></a>
<a class="sourceLine" id="cb6-3" title="3">iris <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-4" title="4"><span class="st">  </span>generateNA <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-5" title="5"><span class="st">  </span>as_tibble <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-6" title="6"><span class="st">  </span><span class="kw">missRanger</span>(<span class="dt">verbose =</span> <span class="dv">0</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-7" title="7"><span class="st">  </span>head</a>
<a class="sourceLine" id="cb6-8" title="8"><span class="co">#&gt; # A tibble: 6 x 5</span></a>
<a class="sourceLine" id="cb6-9" title="9"><span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span></a>
<a class="sourceLine" id="cb6-10" title="10"><span class="co">#&gt;          &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt; &lt;fct&gt;  </span></a>
<a class="sourceLine" id="cb6-11" title="11"><span class="co">#&gt; 1         5.1         3.5          1.4        0.310 setosa </span></a>
<a class="sourceLine" id="cb6-12" title="12"><span class="co">#&gt; 2         4.9         3.04         1.4        0.2   setosa </span></a>
<a class="sourceLine" id="cb6-13" title="13"><span class="co">#&gt; 3         4.7         3.2          1.3        0.2   setosa </span></a>
<a class="sourceLine" id="cb6-14" title="14"><span class="co">#&gt; 4         4.6         3.1          1.5        0.2   setosa </span></a>
<a class="sourceLine" id="cb6-15" title="15"><span class="co">#&gt; 5         5           3.21         1.48       0.2   setosa </span></a>
<a class="sourceLine" id="cb6-16" title="16"><span class="co">#&gt; 6         6.69        3.9          3.08       0.4   setosa</span></a></code></pre></div>
<p>By default <code>missRanger</code> uses all columns in the data set to impute all columns with missings. To override this behaviour, you can use an intuitive formula interface: The left hand side specifies the variables to be imputed (variable names separated by a <code>+</code>), while the right hand side lists the variables used for imputation.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="co"># Impute all variables with all (default behaviour). Note that variables without</span></a>
<a class="sourceLine" id="cb7-2" title="2"><span class="co"># missing values will be skipped from the left hand side of the formula.</span></a>
<a class="sourceLine" id="cb7-3" title="3"><span class="kw">head</span>(m &lt;-<span class="st"> </span><span class="kw">missRanger</span>(irisWithNA, <span class="dt">formula =</span> . <span class="op">~</span><span class="st"> </span>., <span class="dt">pmm.k =</span> <span class="dv">3</span>, <span class="dt">num.trees =</span> <span class="dv">10</span>))</a>
<a class="sourceLine" id="cb7-4" title="4"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-5" title="5"><span class="co">#&gt; Missing value imputation by random forests</span></a>
<a class="sourceLine" id="cb7-6" title="6"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-7" title="7"><span class="co">#&gt;   Variables to impute:       Sepal.Length, Sepal.Width, Petal.Length, Petal.Width, Species</span></a>
<a class="sourceLine" id="cb7-8" title="8"><span class="co">#&gt;   Variables used to impute:  Sepal.Length, Sepal.Width, Petal.Length, Petal.Width, Species</span></a>
<a class="sourceLine" id="cb7-9" title="9"><span class="co">#&gt; iter 1:  .....</span></a>
<a class="sourceLine" id="cb7-10" title="10"><span class="co">#&gt; iter 2:  .....</span></a>
<a class="sourceLine" id="cb7-11" title="11"><span class="co">#&gt; iter 3:  .....</span></a>
<a class="sourceLine" id="cb7-12" title="12"><span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span></a>
<a class="sourceLine" id="cb7-13" title="13"><span class="co">#&gt; 1          5.1         3.5          1.5         0.2  setosa</span></a>
<a class="sourceLine" id="cb7-14" title="14"><span class="co">#&gt; 2          4.9         3.0          1.4         0.3  setosa</span></a>
<a class="sourceLine" id="cb7-15" title="15"><span class="co">#&gt; 3          4.7         3.2          1.3         0.2  setosa</span></a>
<a class="sourceLine" id="cb7-16" title="16"><span class="co">#&gt; 4          5.9         3.0          4.1         0.2  setosa</span></a>
<a class="sourceLine" id="cb7-17" title="17"><span class="co">#&gt; 5          5.0         3.6          1.4         0.4  setosa</span></a>
<a class="sourceLine" id="cb7-18" title="18"><span class="co">#&gt; 6          5.4         3.9          1.6         0.4  setosa</span></a>
<a class="sourceLine" id="cb7-19" title="19"></a>
<a class="sourceLine" id="cb7-20" title="20"><span class="co"># Same</span></a>
<a class="sourceLine" id="cb7-21" title="21"><span class="kw">head</span>(m &lt;-<span class="st"> </span><span class="kw">missRanger</span>(irisWithNA, <span class="dt">pmm.k =</span> <span class="dv">3</span>, <span class="dt">num.trees =</span> <span class="dv">10</span>))</a>
<a class="sourceLine" id="cb7-22" title="22"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-23" title="23"><span class="co">#&gt; Missing value imputation by random forests</span></a>
<a class="sourceLine" id="cb7-24" title="24"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-25" title="25"><span class="co">#&gt;   Variables to impute:       Sepal.Length, Sepal.Width, Petal.Length, Petal.Width, Species</span></a>
<a class="sourceLine" id="cb7-26" title="26"><span class="co">#&gt;   Variables used to impute:  Sepal.Length, Sepal.Width, Petal.Length, Petal.Width, Species</span></a>
<a class="sourceLine" id="cb7-27" title="27"><span class="co">#&gt; iter 1:  .....</span></a>
<a class="sourceLine" id="cb7-28" title="28"><span class="co">#&gt; iter 2:  .....</span></a>
<a class="sourceLine" id="cb7-29" title="29"><span class="co">#&gt; iter 3:  .....</span></a>
<a class="sourceLine" id="cb7-30" title="30"><span class="co">#&gt; iter 4:  .....</span></a>
<a class="sourceLine" id="cb7-31" title="31"><span class="co">#&gt; iter 5:  .....</span></a>
<a class="sourceLine" id="cb7-32" title="32"><span class="co">#&gt; iter 6:  .....</span></a>
<a class="sourceLine" id="cb7-33" title="33"><span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span></a>
<a class="sourceLine" id="cb7-34" title="34"><span class="co">#&gt; 1          5.1         3.5          1.5         0.2  setosa</span></a>
<a class="sourceLine" id="cb7-35" title="35"><span class="co">#&gt; 2          4.9         3.0          1.4         0.5  setosa</span></a>
<a class="sourceLine" id="cb7-36" title="36"><span class="co">#&gt; 3          4.7         3.2          1.3         0.2  setosa</span></a>
<a class="sourceLine" id="cb7-37" title="37"><span class="co">#&gt; 4          5.5         3.4          1.9         0.2  setosa</span></a>
<a class="sourceLine" id="cb7-38" title="38"><span class="co">#&gt; 5          5.0         3.6          1.4         0.2  setosa</span></a>
<a class="sourceLine" id="cb7-39" title="39"><span class="co">#&gt; 6          5.4         3.9          1.4         0.4  setosa</span></a>
<a class="sourceLine" id="cb7-40" title="40"></a>
<a class="sourceLine" id="cb7-41" title="41"><span class="co"># Impute all variables with all except Species</span></a>
<a class="sourceLine" id="cb7-42" title="42"><span class="kw">head</span>(m &lt;-<span class="st"> </span><span class="kw">missRanger</span>(irisWithNA, . <span class="op">~</span><span class="st"> </span>. <span class="op">-</span><span class="st"> </span>Species, <span class="dt">pmm.k =</span> <span class="dv">3</span>, <span class="dt">num.trees =</span> <span class="dv">10</span>))</a>
<a class="sourceLine" id="cb7-43" title="43"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-44" title="44"><span class="co">#&gt; Missing value imputation by random forests</span></a>
<a class="sourceLine" id="cb7-45" title="45"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-46" title="46"><span class="co">#&gt;   Variables to impute:       Sepal.Length, Sepal.Width, Petal.Length, Petal.Width, Species</span></a>
<a class="sourceLine" id="cb7-47" title="47"><span class="co">#&gt;   Variables used to impute:  Sepal.Length, Sepal.Width, Petal.Length, Petal.Width</span></a>
<a class="sourceLine" id="cb7-48" title="48"><span class="co">#&gt; iter 1:  .....</span></a>
<a class="sourceLine" id="cb7-49" title="49"><span class="co">#&gt; iter 2:  .....</span></a>
<a class="sourceLine" id="cb7-50" title="50"><span class="co">#&gt; iter 3:  .....</span></a>
<a class="sourceLine" id="cb7-51" title="51"><span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span></a>
<a class="sourceLine" id="cb7-52" title="52"><span class="co">#&gt; 1          5.1         3.5          1.3         0.2  setosa</span></a>
<a class="sourceLine" id="cb7-53" title="53"><span class="co">#&gt; 2          4.9         3.0          1.4         0.2  setosa</span></a>
<a class="sourceLine" id="cb7-54" title="54"><span class="co">#&gt; 3          4.7         3.2          1.3         0.2  setosa</span></a>
<a class="sourceLine" id="cb7-55" title="55"><span class="co">#&gt; 4          6.4         3.1          3.8         0.2  setosa</span></a>
<a class="sourceLine" id="cb7-56" title="56"><span class="co">#&gt; 5          5.0         3.6          1.4         0.1  setosa</span></a>
<a class="sourceLine" id="cb7-57" title="57"><span class="co">#&gt; 6          5.4         3.9          1.4         0.4  setosa</span></a>
<a class="sourceLine" id="cb7-58" title="58"></a>
<a class="sourceLine" id="cb7-59" title="59"><span class="co"># Impute Sepal.Width by Species </span></a>
<a class="sourceLine" id="cb7-60" title="60"><span class="kw">head</span>(m &lt;-<span class="st"> </span><span class="kw">missRanger</span>(irisWithNA, Sepal.Width <span class="op">~</span><span class="st"> </span>Species, <span class="dt">pmm.k =</span> <span class="dv">3</span>, <span class="dt">num.trees =</span> <span class="dv">10</span>))</a>
<a class="sourceLine" id="cb7-61" title="61"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-62" title="62"><span class="co">#&gt; Missing value imputation by random forests</span></a>
<a class="sourceLine" id="cb7-63" title="63"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-64" title="64"><span class="co">#&gt;   Variables to impute:       Sepal.Width</span></a>
<a class="sourceLine" id="cb7-65" title="65"><span class="co">#&gt;   Variables used to impute:  </span></a>
<a class="sourceLine" id="cb7-66" title="66"><span class="co">#&gt; iter 1:  .</span></a>
<a class="sourceLine" id="cb7-67" title="67"><span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span></a>
<a class="sourceLine" id="cb7-68" title="68"><span class="co">#&gt; 1          5.1         3.5           NA         0.2  setosa</span></a>
<a class="sourceLine" id="cb7-69" title="69"><span class="co">#&gt; 2          4.9         3.0          1.4          NA  setosa</span></a>
<a class="sourceLine" id="cb7-70" title="70"><span class="co">#&gt; 3          4.7         3.2          1.3         0.2  setosa</span></a>
<a class="sourceLine" id="cb7-71" title="71"><span class="co">#&gt; 4           NA         3.0           NA         0.2  setosa</span></a>
<a class="sourceLine" id="cb7-72" title="72"><span class="co">#&gt; 5          5.0         3.6          1.4          NA  setosa</span></a>
<a class="sourceLine" id="cb7-73" title="73"><span class="co">#&gt; 6          5.4         3.9           NA         0.4  setosa</span></a>
<a class="sourceLine" id="cb7-74" title="74"></a>
<a class="sourceLine" id="cb7-75" title="75"><span class="co"># No success. Why? Species contains missing values and thus can only be used for imputation if it is being imputed as well</span></a>
<a class="sourceLine" id="cb7-76" title="76"><span class="kw">head</span>(m &lt;-<span class="st"> </span><span class="kw">missRanger</span>(irisWithNA, Sepal.Width <span class="op">+</span><span class="st"> </span>Species <span class="op">~</span><span class="st"> </span>Species, <span class="dt">pmm.k =</span> <span class="dv">3</span>, <span class="dt">num.trees =</span> <span class="dv">10</span>))</a>
<a class="sourceLine" id="cb7-77" title="77"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-78" title="78"><span class="co">#&gt; Missing value imputation by random forests</span></a>
<a class="sourceLine" id="cb7-79" title="79"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-80" title="80"><span class="co">#&gt;   Variables to impute:       Sepal.Width, Species</span></a>
<a class="sourceLine" id="cb7-81" title="81"><span class="co">#&gt;   Variables used to impute:  Species</span></a>
<a class="sourceLine" id="cb7-82" title="82"><span class="co">#&gt; iter 1:  ..</span></a>
<a class="sourceLine" id="cb7-83" title="83"><span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span></a>
<a class="sourceLine" id="cb7-84" title="84"><span class="co">#&gt; 1          5.1         3.5           NA         0.2  setosa</span></a>
<a class="sourceLine" id="cb7-85" title="85"><span class="co">#&gt; 2          4.9         3.0          1.4          NA  setosa</span></a>
<a class="sourceLine" id="cb7-86" title="86"><span class="co">#&gt; 3          4.7         3.2          1.3         0.2  setosa</span></a>
<a class="sourceLine" id="cb7-87" title="87"><span class="co">#&gt; 4           NA         3.2           NA         0.2  setosa</span></a>
<a class="sourceLine" id="cb7-88" title="88"><span class="co">#&gt; 5          5.0         3.6          1.4          NA  setosa</span></a>
<a class="sourceLine" id="cb7-89" title="89"><span class="co">#&gt; 6          5.4         3.9           NA         0.4  setosa</span></a>
<a class="sourceLine" id="cb7-90" title="90"></a>
<a class="sourceLine" id="cb7-91" title="91"><span class="co"># Impute all variables univariatly</span></a>
<a class="sourceLine" id="cb7-92" title="92"><span class="kw">head</span>(m &lt;-<span class="st"> </span><span class="kw">missRanger</span>(irisWithNA, . <span class="op">~</span><span class="st"> </span><span class="dv">1</span>))</a>
<a class="sourceLine" id="cb7-93" title="93"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-94" title="94"><span class="co">#&gt; Missing value imputation by random forests</span></a>
<a class="sourceLine" id="cb7-95" title="95"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-96" title="96"><span class="co">#&gt;   Variables to impute:       Sepal.Length, Sepal.Width, Petal.Length, Petal.Width, Species</span></a>
<a class="sourceLine" id="cb7-97" title="97"><span class="co">#&gt;   Variables used to impute:  </span></a>
<a class="sourceLine" id="cb7-98" title="98"><span class="co">#&gt; iter 1:  .....</span></a>
<a class="sourceLine" id="cb7-99" title="99"><span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span></a>
<a class="sourceLine" id="cb7-100" title="100"><span class="co">#&gt; 1          5.1         3.5          1.9         0.2  setosa</span></a>
<a class="sourceLine" id="cb7-101" title="101"><span class="co">#&gt; 2          4.9         3.0          1.4         2.0  setosa</span></a>
<a class="sourceLine" id="cb7-102" title="102"><span class="co">#&gt; 3          4.7         3.2          1.3         0.2  setosa</span></a>
<a class="sourceLine" id="cb7-103" title="103"><span class="co">#&gt; 4          4.6         4.1          5.6         0.2  setosa</span></a>
<a class="sourceLine" id="cb7-104" title="104"><span class="co">#&gt; 5          5.0         3.6          1.4         0.2  setosa</span></a>
<a class="sourceLine" id="cb7-105" title="105"><span class="co">#&gt; 6          5.4         3.9          5.9         0.4  setosa</span></a></code></pre></div>
</div>
<div id="imputation-takes-too-much-time.-what-can-i-do" class="section level2">
<h2>Imputation takes too much time. What can I do?</h2>
<p><code>missRanger</code> is based on iteratively fitting random forests for each variable with missing values. Since the underlying random forest implementation <code>ranger</code> uses 500 trees per default, a huge number of trees might be calculated. For larger data sets, the overall process can take very long.</p>
<p>Here are tweaks to make things faster:</p>
<ul>
<li><p>Use less trees, e.g. by setting <code>num.trees = 50</code>. Even one single tree might be sufficient. Typically, the number of iterations until convergence will increase with fewer trees though.</p></li>
<li><p>Use smaller bootstrap samples by setting e.g. <code>sample.fraction = 0.1</code>.</p></li>
<li><p>Use the less greedy <code>splitrule = &quot;extratrees&quot;</code>.</p></li>
<li><p>Use a low tree depth <code>max.depth = 6</code>.</p></li>
<li><p>Use large leafs, e.g. <code>min.node.size = 10000</code>.</p></li>
<li><p>Use a low <code>max.iter</code>, e.g. 1 or 2.</p></li>
</ul>
<div id="examples-evaluated-on-a-normal-laptop-not-run-here" class="section level3">
<h3>Examples evaluated on a normal laptop (not run here)</h3>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1"><span class="kw">require</span>(ggplot2) <span class="co"># for diamonds data</span></a>
<a class="sourceLine" id="cb8-2" title="2"><span class="kw">dim</span>(diamonds) <span class="co"># 53940    10</span></a>
<a class="sourceLine" id="cb8-3" title="3"></a>
<a class="sourceLine" id="cb8-4" title="4">diamonds_with_NA &lt;-<span class="st"> </span><span class="kw">generateNA</span>(diamonds)</a>
<a class="sourceLine" id="cb8-5" title="5"></a>
<a class="sourceLine" id="cb8-6" title="6"><span class="co"># Takes 270 seconds (10 * 500 trees per iteration!)</span></a>
<a class="sourceLine" id="cb8-7" title="7"><span class="kw">system.time</span>(m &lt;-<span class="st"> </span><span class="kw">missRanger</span>(diamonds_with_NA, <span class="dt">pmm.k =</span> <span class="dv">3</span>))</a>
<a class="sourceLine" id="cb8-8" title="8"></a>
<a class="sourceLine" id="cb8-9" title="9"><span class="co"># Takes 19 seconds</span></a>
<a class="sourceLine" id="cb8-10" title="10"><span class="kw">system.time</span>(m &lt;-<span class="st"> </span><span class="kw">missRanger</span>(diamonds_with_NA, <span class="dt">pmm.k =</span> <span class="dv">3</span>, <span class="dt">num.trees =</span> <span class="dv">50</span>))</a>
<a class="sourceLine" id="cb8-11" title="11"></a>
<a class="sourceLine" id="cb8-12" title="12"><span class="co"># Takes 7 seconds</span></a>
<a class="sourceLine" id="cb8-13" title="13"><span class="kw">system.time</span>(m &lt;-<span class="st"> </span><span class="kw">missRanger</span>(diamonds_with_NA, <span class="dt">pmm.k =</span> <span class="dv">3</span>, <span class="dt">num.trees =</span> <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb8-14" title="14"></a>
<a class="sourceLine" id="cb8-15" title="15"><span class="co"># Takes 9 seconds</span></a>
<a class="sourceLine" id="cb8-16" title="16"><span class="kw">system.time</span>(m &lt;-<span class="st"> </span><span class="kw">missRanger</span>(diamonds_with_NA, <span class="dt">pmm.k =</span> <span class="dv">3</span>, <span class="dt">num.trees =</span> <span class="dv">50</span>, <span class="dt">sample.fraction =</span> <span class="fl">0.1</span>))</a></code></pre></div>
</div>
</div>
<div id="trick-use-case.weights-to-weight-down-contribution-of-rows-with-many-missings" class="section level2">
<h2>Trick: Use <code>case.weights</code> to weight down contribution of rows with many missings</h2>
<p>Using the <code>case.weights</code> argument, you can pass case weights to the imputation models. This might be e.g. useful to weight down the contribution of rows with many missings.</p>
<div id="example" class="section level3">
<h3>Example</h3>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1"><span class="co"># Count the number of non-missing values per row</span></a>
<a class="sourceLine" id="cb9-2" title="2">non_miss &lt;-<span class="st"> </span><span class="kw">rowSums</span>(<span class="op">!</span><span class="kw">is.na</span>(irisWithNA))</a>
<a class="sourceLine" id="cb9-3" title="3"><span class="kw">table</span>(non_miss)</a>
<a class="sourceLine" id="cb9-4" title="4"><span class="co">#&gt; non_miss</span></a>
<a class="sourceLine" id="cb9-5" title="5"><span class="co">#&gt;  1  2  3  4  5 </span></a>
<a class="sourceLine" id="cb9-6" title="6"><span class="co">#&gt;  2  6 28 68 46</span></a>
<a class="sourceLine" id="cb9-7" title="7"></a>
<a class="sourceLine" id="cb9-8" title="8"><span class="co"># No weighting</span></a>
<a class="sourceLine" id="cb9-9" title="9"><span class="kw">head</span>(m &lt;-<span class="st"> </span><span class="kw">missRanger</span>(irisWithNA, <span class="dt">num.trees =</span> <span class="dv">20</span>, <span class="dt">pmm.k =</span> <span class="dv">3</span>, <span class="dt">seed =</span> <span class="dv">5</span>))</a>
<a class="sourceLine" id="cb9-10" title="10"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb9-11" title="11"><span class="co">#&gt; Missing value imputation by random forests</span></a>
<a class="sourceLine" id="cb9-12" title="12"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb9-13" title="13"><span class="co">#&gt;   Variables to impute:       Sepal.Length, Sepal.Width, Petal.Length, Petal.Width, Species</span></a>
<a class="sourceLine" id="cb9-14" title="14"><span class="co">#&gt;   Variables used to impute:  Sepal.Length, Sepal.Width, Petal.Length, Petal.Width, Species</span></a>
<a class="sourceLine" id="cb9-15" title="15"><span class="co">#&gt; iter 1:  .....</span></a>
<a class="sourceLine" id="cb9-16" title="16"><span class="co">#&gt; iter 2:  .....</span></a>
<a class="sourceLine" id="cb9-17" title="17"><span class="co">#&gt; iter 3:  .....</span></a>
<a class="sourceLine" id="cb9-18" title="18"><span class="co">#&gt; iter 4:  .....</span></a>
<a class="sourceLine" id="cb9-19" title="19"><span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span></a>
<a class="sourceLine" id="cb9-20" title="20"><span class="co">#&gt; 1          5.1         3.5          1.5         0.2  setosa</span></a>
<a class="sourceLine" id="cb9-21" title="21"><span class="co">#&gt; 2          4.9         3.0          1.4         0.1  setosa</span></a>
<a class="sourceLine" id="cb9-22" title="22"><span class="co">#&gt; 3          4.7         3.2          1.3         0.2  setosa</span></a>
<a class="sourceLine" id="cb9-23" title="23"><span class="co">#&gt; 4          5.7         3.8          1.5         0.2  setosa</span></a>
<a class="sourceLine" id="cb9-24" title="24"><span class="co">#&gt; 5          5.0         3.6          1.4         0.2  setosa</span></a>
<a class="sourceLine" id="cb9-25" title="25"><span class="co">#&gt; 6          5.4         3.9          1.5         0.4  setosa</span></a>
<a class="sourceLine" id="cb9-26" title="26"></a>
<a class="sourceLine" id="cb9-27" title="27"><span class="co"># Weighted by number of non-missing values per row. </span></a>
<a class="sourceLine" id="cb9-28" title="28"><span class="kw">head</span>(m &lt;-<span class="st"> </span><span class="kw">missRanger</span>(irisWithNA, <span class="dt">num.trees =</span> <span class="dv">20</span>, <span class="dt">pmm.k =</span> <span class="dv">3</span>, <span class="dt">seed =</span> <span class="dv">5</span>, <span class="dt">case.weights =</span> non_miss))</a>
<a class="sourceLine" id="cb9-29" title="29"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb9-30" title="30"><span class="co">#&gt; Missing value imputation by random forests</span></a>
<a class="sourceLine" id="cb9-31" title="31"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb9-32" title="32"><span class="co">#&gt;   Variables to impute:       Sepal.Length, Sepal.Width, Petal.Length, Petal.Width, Species</span></a>
<a class="sourceLine" id="cb9-33" title="33"><span class="co">#&gt;   Variables used to impute:  Sepal.Length, Sepal.Width, Petal.Length, Petal.Width, Species</span></a>
<a class="sourceLine" id="cb9-34" title="34"><span class="co">#&gt; iter 1:  .....</span></a>
<a class="sourceLine" id="cb9-35" title="35"><span class="co">#&gt; iter 2:  .....</span></a>
<a class="sourceLine" id="cb9-36" title="36"><span class="co">#&gt; iter 3:  .....</span></a>
<a class="sourceLine" id="cb9-37" title="37"><span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span></a>
<a class="sourceLine" id="cb9-38" title="38"><span class="co">#&gt; 1          5.1         3.5          1.3         0.2  setosa</span></a>
<a class="sourceLine" id="cb9-39" title="39"><span class="co">#&gt; 2          4.9         3.0          1.4         0.1  setosa</span></a>
<a class="sourceLine" id="cb9-40" title="40"><span class="co">#&gt; 3          4.7         3.2          1.3         0.2  setosa</span></a>
<a class="sourceLine" id="cb9-41" title="41"><span class="co">#&gt; 4          5.4         3.4          1.4         0.2  setosa</span></a>
<a class="sourceLine" id="cb9-42" title="42"><span class="co">#&gt; 5          5.0         3.6          1.4         0.2  setosa</span></a>
<a class="sourceLine" id="cb9-43" title="43"><span class="co">#&gt; 6          5.4         3.9          1.1         0.4  setosa</span></a></code></pre></div>
</div>
</div>
<div id="how-to-use-missranger-in-multiple-imputation-settings" class="section level2">
<h2>How to use <code>missRanger</code> in multiple imputation settings?</h2>
<p>For machine learning tasks, imputation is typically seen as a fixed data preparation step like dummy coding. There, multiple imputation is rarely applied as it adds another level of complexity to the analysis. This might be fine since a good validation schema will account for variation introduced by imputation.</p>
<p>For tasks with focus on statistical inference (p values, standard errors, confidence intervals, estimation of effects), the extra variability introduced by imputation has to be accounted for except if only very few missing values appear. One of the standard approaches is to impute the data set multiple times, generating e.g. 10 or 100 versions of a complete data set. Then, the intended analysis (t-test, linear model etc.) is applied independently to each of the complete data sets. Their results are combined afterward in a pooling step, usually by Rubin’s rule [4]. For parameter estimates, averages are taken. Their variance is basically a combination of the average squared standard errors plus the variance of the parameter estimates across the imputed data sets, leading to inflated standard errors and thus larger p values and wider confidence intervals.</p>
<p>The package <code>mice</code> [3] takes case of this pooling step. The creation of multiple complete data sets can be done by <code>mice</code> or also by <code>missRanger</code>. In the latter case, in order to keep the variance of imputed values at a realistic level, we suggest to use predictive mean matching on top of the random forest imputations.</p>
<p>The following example shows how easy such workflow looks like.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1">irisWithNA &lt;-<span class="st"> </span><span class="kw">generateNA</span>(iris, <span class="dt">p =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>))</a>
<a class="sourceLine" id="cb10-2" title="2"></a>
<a class="sourceLine" id="cb10-3" title="3"><span class="co"># Generate 20 complete data sets</span></a>
<a class="sourceLine" id="cb10-4" title="4">filled &lt;-<span class="st"> </span><span class="kw">replicate</span>(<span class="dv">20</span>, <span class="kw">missRanger</span>(irisWithNA, <span class="dt">verbose =</span> <span class="dv">0</span>, <span class="dt">num.trees =</span> <span class="dv">100</span>, <span class="dt">pmm.k =</span> <span class="dv">5</span>), <span class="dt">simplify =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb10-5" title="5">                           </a>
<a class="sourceLine" id="cb10-6" title="6"><span class="co"># Run a linear model for each of the completed data sets                          </span></a>
<a class="sourceLine" id="cb10-7" title="7">models &lt;-<span class="st"> </span><span class="kw">lapply</span>(filled, <span class="cf">function</span>(x) <span class="kw">lm</span>(Sepal.Length <span class="op">~</span><span class="st"> </span>., x))</a>
<a class="sourceLine" id="cb10-8" title="8"></a>
<a class="sourceLine" id="cb10-9" title="9"><span class="co"># Pool the results by mice</span></a>
<a class="sourceLine" id="cb10-10" title="10"><span class="kw">require</span>(mice)</a>
<a class="sourceLine" id="cb10-11" title="11"><span class="kw">summary</span>(pooled_fit &lt;-<span class="st"> </span><span class="kw">pool</span>(models))</a>
<a class="sourceLine" id="cb10-12" title="12"><span class="co">#&gt;                     estimate  std.error statistic       df      p.value</span></a>
<a class="sourceLine" id="cb10-13" title="13"><span class="co">#&gt; (Intercept)        2.3237581 0.31344494  7.413609 79.09153 1.191021e-10</span></a>
<a class="sourceLine" id="cb10-14" title="14"><span class="co">#&gt; Sepal.Width        0.4820868 0.09965924  4.837352 70.91717 7.413834e-06</span></a>
<a class="sourceLine" id="cb10-15" title="15"><span class="co">#&gt; Petal.Length       0.7602107 0.07799618  9.746768 75.59176 5.329071e-15</span></a>
<a class="sourceLine" id="cb10-16" title="16"><span class="co">#&gt; Petal.Width       -0.2594143 0.15886858 -1.632886 77.07308 1.065721e-01</span></a>
<a class="sourceLine" id="cb10-17" title="17"><span class="co">#&gt; Speciesversicolor -0.6312472 0.27946995 -2.258730 59.13447 2.760202e-02</span></a>
<a class="sourceLine" id="cb10-18" title="18"><span class="co">#&gt; Speciesvirginica  -0.8448732 0.38541621 -2.192106 59.56188 3.229175e-02</span></a>
<a class="sourceLine" id="cb10-19" title="19"></a>
<a class="sourceLine" id="cb10-20" title="20"><span class="co"># Compare with model on original data</span></a>
<a class="sourceLine" id="cb10-21" title="21"><span class="kw">summary</span>(<span class="kw">lm</span>(Sepal.Length <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> iris))</a>
<a class="sourceLine" id="cb10-22" title="22"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb10-23" title="23"><span class="co">#&gt; Call:</span></a>
<a class="sourceLine" id="cb10-24" title="24"><span class="co">#&gt; lm(formula = Sepal.Length ~ ., data = iris)</span></a>
<a class="sourceLine" id="cb10-25" title="25"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb10-26" title="26"><span class="co">#&gt; Residuals:</span></a>
<a class="sourceLine" id="cb10-27" title="27"><span class="co">#&gt;      Min       1Q   Median       3Q      Max </span></a>
<a class="sourceLine" id="cb10-28" title="28"><span class="co">#&gt; -0.79424 -0.21874  0.00899  0.20255  0.73103 </span></a>
<a class="sourceLine" id="cb10-29" title="29"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb10-30" title="30"><span class="co">#&gt; Coefficients:</span></a>
<a class="sourceLine" id="cb10-31" title="31"><span class="co">#&gt;                   Estimate Std. Error t value Pr(&gt;|t|)    </span></a>
<a class="sourceLine" id="cb10-32" title="32"><span class="co">#&gt; (Intercept)        2.17127    0.27979   7.760 1.43e-12 ***</span></a>
<a class="sourceLine" id="cb10-33" title="33"><span class="co">#&gt; Sepal.Width        0.49589    0.08607   5.761 4.87e-08 ***</span></a>
<a class="sourceLine" id="cb10-34" title="34"><span class="co">#&gt; Petal.Length       0.82924    0.06853  12.101  &lt; 2e-16 ***</span></a>
<a class="sourceLine" id="cb10-35" title="35"><span class="co">#&gt; Petal.Width       -0.31516    0.15120  -2.084  0.03889 *  </span></a>
<a class="sourceLine" id="cb10-36" title="36"><span class="co">#&gt; Speciesversicolor -0.72356    0.24017  -3.013  0.00306 ** </span></a>
<a class="sourceLine" id="cb10-37" title="37"><span class="co">#&gt; Speciesvirginica  -1.02350    0.33373  -3.067  0.00258 ** </span></a>
<a class="sourceLine" id="cb10-38" title="38"><span class="co">#&gt; ---</span></a>
<a class="sourceLine" id="cb10-39" title="39"><span class="co">#&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></a>
<a class="sourceLine" id="cb10-40" title="40"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb10-41" title="41"><span class="co">#&gt; Residual standard error: 0.3068 on 144 degrees of freedom</span></a>
<a class="sourceLine" id="cb10-42" title="42"><span class="co">#&gt; Multiple R-squared:  0.8673, Adjusted R-squared:  0.8627 </span></a>
<a class="sourceLine" id="cb10-43" title="43"><span class="co">#&gt; F-statistic: 188.3 on 5 and 144 DF,  p-value: &lt; 2.2e-16</span></a></code></pre></div>
<p>The standard errors and p values of the multiple imputation are larger than of the original data set. This reflects the additional uncertainty introduced by the presence of missing values in a realistic way.</p>
</div>
<div id="how-to-deal-with-censored-variables" class="section level2">
<h2>How to deal with censored variables?</h2>
<p>There is no obvious way of how to deal with survival variables as covariables in imputation models.</p>
<p>Options discussed in White [5] include:</p>
<ul>
<li><p>Use both status variable s and (censored) time variable t</p></li>
<li><p>s and log(t)</p></li>
<li><p>surv(t), and, optionally s</p></li>
</ul>
<p>By surv(t), we denote the Nelson-Aalen survival estimate at each value of t. The third option is the most elegant one as it explicitly deals with censoring information. We provide some additional details on it in the example</p>
<div id="example-1" class="section level3">
<h3>Example</h3>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1"><span class="kw">require</span>(survival)</a>
<a class="sourceLine" id="cb11-2" title="2"><span class="kw">require</span>(dplyr)</a>
<a class="sourceLine" id="cb11-3" title="3"><span class="kw">head</span>(veteran)</a>
<a class="sourceLine" id="cb11-4" title="4"><span class="co">#&gt;   trt celltype time status karno diagtime age prior</span></a>
<a class="sourceLine" id="cb11-5" title="5"><span class="co">#&gt; 1   1 squamous   72      1    60        7  69     0</span></a>
<a class="sourceLine" id="cb11-6" title="6"><span class="co">#&gt; 2   1 squamous  411      1    70        5  64    10</span></a>
<a class="sourceLine" id="cb11-7" title="7"><span class="co">#&gt; 3   1 squamous  228      1    60        3  38     0</span></a>
<a class="sourceLine" id="cb11-8" title="8"><span class="co">#&gt; 4   1 squamous  126      1    60        9  63    10</span></a>
<a class="sourceLine" id="cb11-9" title="9"><span class="co">#&gt; 5   1 squamous  118      1    70       11  65    10</span></a>
<a class="sourceLine" id="cb11-10" title="10"><span class="co">#&gt; 6   1 squamous   10      1    20        5  49     0</span></a>
<a class="sourceLine" id="cb11-11" title="11"><span class="kw">set.seed</span>(<span class="dv">653</span>)</a>
<a class="sourceLine" id="cb11-12" title="12"></a>
<a class="sourceLine" id="cb11-13" title="13"><span class="co"># For illustration, we use data from a randomized two-arm trial </span></a>
<a class="sourceLine" id="cb11-14" title="14"><span class="co"># about lung cancer. The aim is to estimate the treatment effect</span></a>
<a class="sourceLine" id="cb11-15" title="15"><span class="co"># of &quot;trt&quot; with reliable inference using Cox regression. Unfortunately, </span></a>
<a class="sourceLine" id="cb11-16" title="16"><span class="co"># we generated missing values in the covariables &quot;age&quot; and &quot;karno&quot; (performance</span></a>
<a class="sourceLine" id="cb11-17" title="17"><span class="co"># status). One approach is to use multiple imputation, see the section above.</span></a>
<a class="sourceLine" id="cb11-18" title="18"><span class="co"># It is recommended to use the model response in the imputation models - </span></a>
<a class="sourceLine" id="cb11-19" title="19"><span class="co"># even if it sounds wrong. In case of a censored survival response</span></a>
<a class="sourceLine" id="cb11-20" title="20"><span class="co"># (i.e. consisting of a time/status pair), an elegant </span></a>
<a class="sourceLine" id="cb11-21" title="21"><span class="co"># possibility is to represent it by the estimated Nelson-Aalen estimates [5].</span></a>
<a class="sourceLine" id="cb11-22" title="22"></a>
<a class="sourceLine" id="cb11-23" title="23"><span class="co"># Add the Nelson-Aalen survival probabilities &quot;surv&quot; to the data set</span></a>
<a class="sourceLine" id="cb11-24" title="24">veteran2 &lt;-<span class="st"> </span><span class="kw">summary</span>(<span class="kw">survfit</span>(<span class="kw">Surv</span>(time, status) <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">data =</span> veteran), </a>
<a class="sourceLine" id="cb11-25" title="25">                <span class="dt">times =</span> veteran<span class="op">$</span>time)[<span class="kw">c</span>(<span class="st">&quot;time&quot;</span>, <span class="st">&quot;surv&quot;</span>)] <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-26" title="26"><span class="st">            </span>as_tibble <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-27" title="27"><span class="st">            </span><span class="kw">right_join</span>(veteran, <span class="dt">by =</span> <span class="st">&quot;time&quot;</span>)</a>
<a class="sourceLine" id="cb11-28" title="28"></a>
<a class="sourceLine" id="cb11-29" title="29"><span class="co"># Add missing values to some columns. We do not add missing values</span></a>
<a class="sourceLine" id="cb11-30" title="30"><span class="co"># in the survival information as this is usually the response of the (Cox-) </span></a>
<a class="sourceLine" id="cb11-31" title="31"><span class="co"># modelling process following the imputation.</span></a>
<a class="sourceLine" id="cb11-32" title="32"></a>
<a class="sourceLine" id="cb11-33" title="33">veteran_with_NA &lt;-<span class="st"> </span><span class="kw">generateNA</span>(veteran2, <span class="dt">p =</span> <span class="kw">c</span>(<span class="dt">age =</span> <span class="fl">0.1</span>, <span class="dt">karno =</span> <span class="fl">0.1</span>, <span class="dt">diagtime =</span> <span class="fl">0.1</span>))</a>
<a class="sourceLine" id="cb11-34" title="34"></a>
<a class="sourceLine" id="cb11-35" title="35"><span class="co"># Generate 20 complete data sets and remove &quot;surv&quot;</span></a>
<a class="sourceLine" id="cb11-36" title="36">filled &lt;-<span class="st"> </span><span class="kw">replicate</span>(<span class="dv">20</span>, <span class="kw">missRanger</span>(veteran_with_NA, . <span class="op">~</span><span class="st"> </span>. <span class="op">-</span><span class="st"> </span>time <span class="op">-</span><span class="st"> </span>status, </a>
<a class="sourceLine" id="cb11-37" title="37">  <span class="dt">verbose =</span> <span class="dv">0</span>, <span class="dt">pmm.k =</span> <span class="dv">3</span>, <span class="dt">num.trees =</span> <span class="dv">50</span>), <span class="dt">simplify =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb11-38" title="38"></a>
<a class="sourceLine" id="cb11-39" title="39">filled &lt;-<span class="st"> </span><span class="kw">lapply</span>(filled, <span class="cf">function</span>(data) {data<span class="op">$</span>surv &lt;-<span class="st"> </span><span class="ot">NULL</span>; data})</a>
<a class="sourceLine" id="cb11-40" title="40"></a>
<a class="sourceLine" id="cb11-41" title="41"><span class="co"># Run a Cox proportional hazards regression for each of the completed data sets</span></a>
<a class="sourceLine" id="cb11-42" title="42">models &lt;-<span class="st"> </span><span class="kw">lapply</span>(filled, <span class="cf">function</span>(x) <span class="kw">coxph</span>(<span class="kw">Surv</span>(time, status) <span class="op">~</span><span class="st"> </span>., x))</a>
<a class="sourceLine" id="cb11-43" title="43"></a>
<a class="sourceLine" id="cb11-44" title="44"><span class="co"># Pool the results by mice</span></a>
<a class="sourceLine" id="cb11-45" title="45"><span class="kw">require</span>(mice)</a>
<a class="sourceLine" id="cb11-46" title="46"><span class="kw">summary</span>(pooled_fit &lt;-<span class="st"> </span><span class="kw">pool</span>(models))</a>
<a class="sourceLine" id="cb11-47" title="47"><span class="co">#&gt;                       estimate   std.error  statistic        df</span></a>
<a class="sourceLine" id="cb11-48" title="48"><span class="co">#&gt; trt                0.201959473 0.159267360  1.2680531  6176.473</span></a>
<a class="sourceLine" id="cb11-49" title="49"><span class="co">#&gt; celltypesmallcell  0.836528671 0.214067771  3.9077749 53541.171</span></a>
<a class="sourceLine" id="cb11-50" title="50"><span class="co">#&gt; celltypeadeno      1.079369471 0.238737193  4.5211618  5714.099</span></a>
<a class="sourceLine" id="cb11-51" title="51"><span class="co">#&gt; celltypelarge      0.327385574 0.243147111  1.3464506  5849.810</span></a>
<a class="sourceLine" id="cb11-52" title="52"><span class="co">#&gt; karno             -0.035056963 0.004379610 -8.0045848  2621.609</span></a>
<a class="sourceLine" id="cb11-53" title="53"><span class="co">#&gt; diagtime          -0.003081890 0.006138537 -0.5020561 10297.018</span></a>
<a class="sourceLine" id="cb11-54" title="54"><span class="co">#&gt; age               -0.005642109 0.007954351 -0.7093111   775.675</span></a>
<a class="sourceLine" id="cb11-55" title="55"><span class="co">#&gt; prior              0.007778027 0.018826526  0.4131419 12385.627</span></a>
<a class="sourceLine" id="cb11-56" title="56"><span class="co">#&gt;                        p.value</span></a>
<a class="sourceLine" id="cb11-57" title="57"><span class="co">#&gt; trt               2.048268e-01</span></a>
<a class="sourceLine" id="cb11-58" title="58"><span class="co">#&gt; celltypesmallcell 9.326449e-05</span></a>
<a class="sourceLine" id="cb11-59" title="59"><span class="co">#&gt; celltypeadeno     6.274303e-06</span></a>
<a class="sourceLine" id="cb11-60" title="60"><span class="co">#&gt; celltypelarge     1.782094e-01</span></a>
<a class="sourceLine" id="cb11-61" title="61"><span class="co">#&gt; karno             1.776357e-15</span></a>
<a class="sourceLine" id="cb11-62" title="62"><span class="co">#&gt; diagtime          6.156388e-01</span></a>
<a class="sourceLine" id="cb11-63" title="63"><span class="co">#&gt; age               4.783446e-01</span></a>
<a class="sourceLine" id="cb11-64" title="64"><span class="co">#&gt; prior             6.795098e-01</span></a>
<a class="sourceLine" id="cb11-65" title="65"></a>
<a class="sourceLine" id="cb11-66" title="66"><span class="co"># On the original</span></a>
<a class="sourceLine" id="cb11-67" title="67"><span class="kw">summary</span>(<span class="kw">coxph</span>(<span class="kw">Surv</span>(time, status) <span class="op">~</span><span class="st"> </span>., veteran))</a>
<a class="sourceLine" id="cb11-68" title="68"><span class="co">#&gt; Call:</span></a>
<a class="sourceLine" id="cb11-69" title="69"><span class="co">#&gt; coxph(formula = Surv(time, status) ~ ., data = veteran)</span></a>
<a class="sourceLine" id="cb11-70" title="70"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb11-71" title="71"><span class="co">#&gt;   n= 137, number of events= 128 </span></a>
<a class="sourceLine" id="cb11-72" title="72"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb11-73" title="73"><span class="co">#&gt;                         coef  exp(coef)   se(coef)      z Pr(&gt;|z|)    </span></a>
<a class="sourceLine" id="cb11-74" title="74"><span class="co">#&gt; trt                2.946e-01  1.343e+00  2.075e-01  1.419  0.15577    </span></a>
<a class="sourceLine" id="cb11-75" title="75"><span class="co">#&gt; celltypesmallcell  8.616e-01  2.367e+00  2.753e-01  3.130  0.00175 ** </span></a>
<a class="sourceLine" id="cb11-76" title="76"><span class="co">#&gt; celltypeadeno      1.196e+00  3.307e+00  3.009e-01  3.975 7.05e-05 ***</span></a>
<a class="sourceLine" id="cb11-77" title="77"><span class="co">#&gt; celltypelarge      4.013e-01  1.494e+00  2.827e-01  1.420  0.15574    </span></a>
<a class="sourceLine" id="cb11-78" title="78"><span class="co">#&gt; karno             -3.282e-02  9.677e-01  5.508e-03 -5.958 2.55e-09 ***</span></a>
<a class="sourceLine" id="cb11-79" title="79"><span class="co">#&gt; diagtime           8.132e-05  1.000e+00  9.136e-03  0.009  0.99290    </span></a>
<a class="sourceLine" id="cb11-80" title="80"><span class="co">#&gt; age               -8.706e-03  9.913e-01  9.300e-03 -0.936  0.34920    </span></a>
<a class="sourceLine" id="cb11-81" title="81"><span class="co">#&gt; prior              7.159e-03  1.007e+00  2.323e-02  0.308  0.75794    </span></a>
<a class="sourceLine" id="cb11-82" title="82"><span class="co">#&gt; ---</span></a>
<a class="sourceLine" id="cb11-83" title="83"><span class="co">#&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></a>
<a class="sourceLine" id="cb11-84" title="84"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb11-85" title="85"><span class="co">#&gt;                   exp(coef) exp(-coef) lower .95 upper .95</span></a>
<a class="sourceLine" id="cb11-86" title="86"><span class="co">#&gt; trt                  1.3426     0.7448    0.8939    2.0166</span></a>
<a class="sourceLine" id="cb11-87" title="87"><span class="co">#&gt; celltypesmallcell    2.3669     0.4225    1.3799    4.0597</span></a>
<a class="sourceLine" id="cb11-88" title="88"><span class="co">#&gt; celltypeadeno        3.3071     0.3024    1.8336    5.9647</span></a>
<a class="sourceLine" id="cb11-89" title="89"><span class="co">#&gt; celltypelarge        1.4938     0.6695    0.8583    2.5996</span></a>
<a class="sourceLine" id="cb11-90" title="90"><span class="co">#&gt; karno                0.9677     1.0334    0.9573    0.9782</span></a>
<a class="sourceLine" id="cb11-91" title="91"><span class="co">#&gt; diagtime             1.0001     0.9999    0.9823    1.0182</span></a>
<a class="sourceLine" id="cb11-92" title="92"><span class="co">#&gt; age                  0.9913     1.0087    0.9734    1.0096</span></a>
<a class="sourceLine" id="cb11-93" title="93"><span class="co">#&gt; prior                1.0072     0.9929    0.9624    1.0541</span></a>
<a class="sourceLine" id="cb11-94" title="94"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb11-95" title="95"><span class="co">#&gt; Concordance= 0.736  (se = 0.021 )</span></a>
<a class="sourceLine" id="cb11-96" title="96"><span class="co">#&gt; Likelihood ratio test= 62.1  on 8 df,   p=2e-10</span></a>
<a class="sourceLine" id="cb11-97" title="97"><span class="co">#&gt; Wald test            = 62.37  on 8 df,   p=2e-10</span></a>
<a class="sourceLine" id="cb11-98" title="98"><span class="co">#&gt; Score (logrank) test = 66.74  on 8 df,   p=2e-11</span></a></code></pre></div>
</div>
</div>
<div id="how-to-deal-with-date-variables-etc." class="section level2">
<h2>How to deal with date variables etc.?</h2>
<p>Originally, <code>missRanger</code> could deal only with factors and numeric variables. Since Release 2.1.0, most reasonable types are supported, including dates, date times etc. If there are problems with some special column type, you still have the option to convert it yourself or exclude it by the formula interface explained above.</p>
<div id="example-2" class="section level3">
<h3>Example</h3>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1">ir &lt;-<span class="st"> </span>iris</a>
<a class="sourceLine" id="cb12-2" title="2">ir<span class="op">$</span>s &lt;-<span class="st"> </span>iris<span class="op">$</span>Species <span class="op">==</span><span class="st"> &quot;setosa&quot;</span></a>
<a class="sourceLine" id="cb12-3" title="3">ir<span class="op">$</span>dt &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="kw">Sys.time</span>(), <span class="dt">by =</span> <span class="st">&quot;1 min&quot;</span>, <span class="dt">length.out =</span> <span class="dv">150</span>)</a>
<a class="sourceLine" id="cb12-4" title="4">ir<span class="op">$</span>d &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="kw">Sys.Date</span>(), <span class="dt">by =</span> <span class="st">&quot;1 d&quot;</span>, <span class="dt">length.out =</span> <span class="dv">150</span>)</a>
<a class="sourceLine" id="cb12-5" title="5">ir<span class="op">$</span>ch &lt;-<span class="st"> </span><span class="kw">as.character</span>(iris<span class="op">$</span>Species)</a>
<a class="sourceLine" id="cb12-6" title="6"><span class="kw">head</span>(ir &lt;-<span class="st"> </span><span class="kw">generateNA</span>(ir, <span class="kw">c</span>(<span class="kw">rep</span>(<span class="fl">0.2</span>, <span class="dv">7</span>), <span class="dv">0</span>, <span class="dv">0</span>)))</a>
<a class="sourceLine" id="cb12-7" title="7"><span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species    s</span></a>
<a class="sourceLine" id="cb12-8" title="8"><span class="co">#&gt; 1          5.1         3.5          1.4         0.2  setosa TRUE</span></a>
<a class="sourceLine" id="cb12-9" title="9"><span class="co">#&gt; 2          4.9         3.0          1.4          NA  setosa TRUE</span></a>
<a class="sourceLine" id="cb12-10" title="10"><span class="co">#&gt; 3          4.7         3.2          1.3         0.2  setosa TRUE</span></a>
<a class="sourceLine" id="cb12-11" title="11"><span class="co">#&gt; 4          4.6         3.1           NA          NA  setosa TRUE</span></a>
<a class="sourceLine" id="cb12-12" title="12"><span class="co">#&gt; 5           NA          NA          1.4         0.2  setosa TRUE</span></a>
<a class="sourceLine" id="cb12-13" title="13"><span class="co">#&gt; 6           NA         3.9          1.7         0.4  setosa TRUE</span></a>
<a class="sourceLine" id="cb12-14" title="14"><span class="co">#&gt;                    dt          d     ch</span></a>
<a class="sourceLine" id="cb12-15" title="15"><span class="co">#&gt; 1 2019-06-30 21:32:03 2019-06-30 setosa</span></a>
<a class="sourceLine" id="cb12-16" title="16"><span class="co">#&gt; 2 2019-06-30 21:33:03 2019-07-01 setosa</span></a>
<a class="sourceLine" id="cb12-17" title="17"><span class="co">#&gt; 3 2019-06-30 21:34:03 2019-07-02 setosa</span></a>
<a class="sourceLine" id="cb12-18" title="18"><span class="co">#&gt; 4 2019-06-30 21:35:03 2019-07-03 setosa</span></a>
<a class="sourceLine" id="cb12-19" title="19"><span class="co">#&gt; 5                &lt;NA&gt; 2019-07-04 setosa</span></a>
<a class="sourceLine" id="cb12-20" title="20"><span class="co">#&gt; 6 2019-06-30 21:37:03 2019-07-05 setosa</span></a>
<a class="sourceLine" id="cb12-21" title="21"><span class="kw">head</span>(m &lt;-<span class="st"> </span><span class="kw">missRanger</span>(ir, <span class="dt">pmm.k =</span> <span class="dv">4</span>))</a>
<a class="sourceLine" id="cb12-22" title="22"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb12-23" title="23"><span class="co">#&gt; Missing value imputation by random forests</span></a>
<a class="sourceLine" id="cb12-24" title="24"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb12-25" title="25"><span class="co">#&gt;   Variables to impute:       Sepal.Length, Sepal.Width, Petal.Length, Petal.Width, Species, s, dt</span></a>
<a class="sourceLine" id="cb12-26" title="26"><span class="co">#&gt;   Variables used to impute:  Sepal.Length, Sepal.Width, Petal.Length, Petal.Width, Species, s, dt, d, ch</span></a>
<a class="sourceLine" id="cb12-27" title="27"><span class="co">#&gt; iter 1:  .......</span></a>
<a class="sourceLine" id="cb12-28" title="28"><span class="co">#&gt; iter 2:  .......</span></a>
<a class="sourceLine" id="cb12-29" title="29"><span class="co">#&gt; iter 3:  .......</span></a>
<a class="sourceLine" id="cb12-30" title="30"><span class="co">#&gt; iter 4:  .......</span></a>
<a class="sourceLine" id="cb12-31" title="31"><span class="co">#&gt; iter 5:  .......</span></a>
<a class="sourceLine" id="cb12-32" title="32"><span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species    s</span></a>
<a class="sourceLine" id="cb12-33" title="33"><span class="co">#&gt; 1          5.1         3.5          1.4         0.2  setosa TRUE</span></a>
<a class="sourceLine" id="cb12-34" title="34"><span class="co">#&gt; 2          4.9         3.0          1.4         0.1  setosa TRUE</span></a>
<a class="sourceLine" id="cb12-35" title="35"><span class="co">#&gt; 3          4.7         3.2          1.3         0.2  setosa TRUE</span></a>
<a class="sourceLine" id="cb12-36" title="36"><span class="co">#&gt; 4          4.6         3.1          1.5         0.2  setosa TRUE</span></a>
<a class="sourceLine" id="cb12-37" title="37"><span class="co">#&gt; 5          4.6         3.5          1.4         0.2  setosa TRUE</span></a>
<a class="sourceLine" id="cb12-38" title="38"><span class="co">#&gt; 6          5.0         3.9          1.7         0.4  setosa TRUE</span></a>
<a class="sourceLine" id="cb12-39" title="39"><span class="co">#&gt;                    dt          d     ch</span></a>
<a class="sourceLine" id="cb12-40" title="40"><span class="co">#&gt; 1 2019-06-30 21:32:03 2019-06-30 setosa</span></a>
<a class="sourceLine" id="cb12-41" title="41"><span class="co">#&gt; 2 2019-06-30 21:33:03 2019-07-01 setosa</span></a>
<a class="sourceLine" id="cb12-42" title="42"><span class="co">#&gt; 3 2019-06-30 21:34:03 2019-07-02 setosa</span></a>
<a class="sourceLine" id="cb12-43" title="43"><span class="co">#&gt; 4 2019-06-30 21:35:03 2019-07-03 setosa</span></a>
<a class="sourceLine" id="cb12-44" title="44"><span class="co">#&gt; 5 2019-06-30 21:32:03 2019-07-04 setosa</span></a>
<a class="sourceLine" id="cb12-45" title="45"><span class="co">#&gt; 6 2019-06-30 21:37:03 2019-07-05 setosa</span></a></code></pre></div>
</div>
</div>
<div id="references" class="section level2">
<h2>References</h2>
<p>[1] Wright, M. N. &amp; Ziegler, A. (2016). ranger: A Fast Implementation of Random Forests for High Dimensional Data in C++ and R. Journal of Statistical Software, in press. <a href="http://arxiv.org/abs/1508.04409" class="uri">http://arxiv.org/abs/1508.04409</a>.</p>
<p>[2] Stekhoven, D.J. and Buehlmann, P. (2012). MissForest - nonparametric missing value imputation for mixed-type data. Bioinformatics, 28(1), 112-118, doi: 10.1093/bioinformatics/btr597</p>
<p>[3] Van Buuren, S. and Groothuis-Oudshoorn, K. (2011). mice: Multivariate Imputation by Chained Equations in R. Journal of Statistical Software, 45(3), 1-67. <a href="http://www.jstatsoft.org/v45/i03/" class="uri">http://www.jstatsoft.org/v45/i03/</a></p>
<p>[4] Rubin, D.B. (1987). <em>Multiple Imputation for Nonresponse in Surveys.</em> New York: John Wiley and Sons.</p>
<p>[5] White IR and Royston P. (2009). Imputing missing covariate values for the Cox model. Statistics in medicine, 28(15), 1982-1998. <a href="doi:10.1002/sim.3618" class="uri">doi:10.1002/sim.3618</a></p>
</div>



<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>

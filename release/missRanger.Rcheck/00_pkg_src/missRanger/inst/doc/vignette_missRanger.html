<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Michael Mayer" />

<meta name="date" content="2019-06-30" />

<title>Using missRanger</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' || rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#header {
text-align: center;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; }  code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Using missRanger</h1>
<h4 class="author">Michael Mayer</h4>
<h4 class="date">2019-06-30</h4>



<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>The aim of this vignette is to introduce the R package <code>missRanger</code> for imputation of missing values and to explain how to use it for multiple imputation.</p>
<p><code>missRanger</code> uses the <code>ranger</code> package [1] to do fast missing value imputation by chained random forest. As such, it can be used as an alternative to <code>missForest</code>, a beautiful algorithm introduced by Stekhoven and Buehlmann in [2]. Basically, each variable is imputed by predictions from a random forest using all other variables as covariables. <code>missRanger</code> iterates multiple times over all variables until the average out-of-bag prediction error of the models stops to improve.</p>
<p>Why should you consider <code>missRanger</code>?</p>
<ul>
<li><p>It is fast.</p></li>
<li><p>It is flexible and intuitive to apply: E.g. calling <code>missRanger(data, . ~ 1)</code> would impute all variables univariately, <code>missRanger(data, Species ~ Sepal.Width)</code> would use <code>Sepal.Width</code> to impute <code>Species</code>.</p></li>
<li><p>It can deal with most realistic variable types, even dates and times without destroying the original data structure.</p></li>
<li><p>It combines random forest imputation with predictive mean matching. This generates realistic variability and avoids “new” values like 0.3334 in a 0-1 coded variable. Like this, <code>missRanger</code> can be used for realistic multiple imputation scenarios, see e.g. [4] for the statistical background.</p></li>
</ul>
<p>In the examples below, we will meet two functions from the <code>missRanger</code> package:</p>
<ul>
<li><p><code>generateNA</code>: To replace values in a data set by missing values.</p></li>
<li><p><code>missRanger</code>: To impute missing values in a data frame.</p></li>
</ul>
</div>
<div id="installation" class="section level2">
<h2>Installation</h2>
<p>From CRAN:</p>
<pre><code>install.packages(&quot;missRanger&quot;)</code></pre>
<p>Latest version from github:</p>
<pre><code>library(devtools)
install_github(&quot;mayer79/missRanger/release/missRanger&quot;)</code></pre>
</div>
<div id="examples" class="section level2">
<h2>Examples</h2>
<p>We first generate a data set with about 20% missing values per column and fill them again by <code>missRanger</code>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="kw">library</span>(missRanger)</span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="kw">set.seed</span>(<span class="dv">84553</span>)</span>
<span id="cb3-3"><a href="#cb3-3"></a></span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="kw">head</span>(iris)</span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span></span>
<span id="cb3-6"><a href="#cb3-6"></a><span class="co">#&gt; 1          5.1         3.5          1.4         0.2  setosa</span></span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="co">#&gt; 2          4.9         3.0          1.4         0.2  setosa</span></span>
<span id="cb3-8"><a href="#cb3-8"></a><span class="co">#&gt; 3          4.7         3.2          1.3         0.2  setosa</span></span>
<span id="cb3-9"><a href="#cb3-9"></a><span class="co">#&gt; 4          4.6         3.1          1.5         0.2  setosa</span></span>
<span id="cb3-10"><a href="#cb3-10"></a><span class="co">#&gt; 5          5.0         3.6          1.4         0.2  setosa</span></span>
<span id="cb3-11"><a href="#cb3-11"></a><span class="co">#&gt; 6          5.4         3.9          1.7         0.4  setosa</span></span>
<span id="cb3-12"><a href="#cb3-12"></a></span>
<span id="cb3-13"><a href="#cb3-13"></a><span class="co"># Generate data with missing values in all columns</span></span>
<span id="cb3-14"><a href="#cb3-14"></a><span class="kw">head</span>(irisWithNA &lt;-<span class="st"> </span><span class="kw">generateNA</span>(iris, <span class="dt">p =</span> <span class="fl">0.2</span>))</span>
<span id="cb3-15"><a href="#cb3-15"></a><span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span></span>
<span id="cb3-16"><a href="#cb3-16"></a><span class="co">#&gt; 1          5.1         3.5           NA         0.2  setosa</span></span>
<span id="cb3-17"><a href="#cb3-17"></a><span class="co">#&gt; 2          4.9         3.0          1.4          NA  setosa</span></span>
<span id="cb3-18"><a href="#cb3-18"></a><span class="co">#&gt; 3          4.7         3.2          1.3         0.2  setosa</span></span>
<span id="cb3-19"><a href="#cb3-19"></a><span class="co">#&gt; 4           NA          NA           NA         0.2  setosa</span></span>
<span id="cb3-20"><a href="#cb3-20"></a><span class="co">#&gt; 5          5.0         3.6          1.4          NA  setosa</span></span>
<span id="cb3-21"><a href="#cb3-21"></a><span class="co">#&gt; 6          5.4         3.9           NA         0.4  setosa</span></span>
<span id="cb3-22"><a href="#cb3-22"></a> </span>
<span id="cb3-23"><a href="#cb3-23"></a><span class="co"># Impute missing values with missRanger</span></span>
<span id="cb3-24"><a href="#cb3-24"></a><span class="kw">head</span>(irisImputed &lt;-<span class="st"> </span><span class="kw">missRanger</span>(irisWithNA, <span class="dt">num.trees =</span> <span class="dv">100</span>))</span>
<span id="cb3-25"><a href="#cb3-25"></a><span class="co">#&gt; </span></span>
<span id="cb3-26"><a href="#cb3-26"></a><span class="co">#&gt; Missing value imputation by random forests</span></span>
<span id="cb3-27"><a href="#cb3-27"></a><span class="co">#&gt; </span></span>
<span id="cb3-28"><a href="#cb3-28"></a><span class="co">#&gt;   Variables to impute:       Sepal.Length, Sepal.Width, Petal.Length, Petal.Width, Species</span></span>
<span id="cb3-29"><a href="#cb3-29"></a><span class="co">#&gt;   Variables used to impute:  Sepal.Length, Sepal.Width, Petal.Length, Petal.Width, Species</span></span>
<span id="cb3-30"><a href="#cb3-30"></a><span class="co">#&gt; iter 1:  .....</span></span>
<span id="cb3-31"><a href="#cb3-31"></a><span class="co">#&gt; iter 2:  .....</span></span>
<span id="cb3-32"><a href="#cb3-32"></a><span class="co">#&gt; iter 3:  .....</span></span>
<span id="cb3-33"><a href="#cb3-33"></a><span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span></span>
<span id="cb3-34"><a href="#cb3-34"></a><span class="co">#&gt; 1     5.100000    3.500000     1.503583   0.2000000  setosa</span></span>
<span id="cb3-35"><a href="#cb3-35"></a><span class="co">#&gt; 2     4.900000    3.000000     1.400000   0.2845833  setosa</span></span>
<span id="cb3-36"><a href="#cb3-36"></a><span class="co">#&gt; 3     4.700000    3.200000     1.300000   0.2000000  setosa</span></span>
<span id="cb3-37"><a href="#cb3-37"></a><span class="co">#&gt; 4     5.673567    3.273117     2.505867   0.2000000  setosa</span></span>
<span id="cb3-38"><a href="#cb3-38"></a><span class="co">#&gt; 5     5.000000    3.600000     1.400000   0.1914333  setosa</span></span>
<span id="cb3-39"><a href="#cb3-39"></a><span class="co">#&gt; 6     5.400000    3.900000     1.509900   0.4000000  setosa</span></span></code></pre></div>
<p>It worked! Unfortunately, the new values look somewhat unnatural due to different rounding. If we would like to avoid this, we just set the <code>pmm.k</code> argument to a positive number. All imputations done during the process are then combined with a predictive mean matching (PMM) step, leading to more natural imputations and improved distributional properties of the resulting values:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="kw">head</span>(irisImputed &lt;-<span class="st"> </span><span class="kw">missRanger</span>(irisWithNA, <span class="dt">pmm.k =</span> <span class="dv">3</span>, <span class="dt">num.trees =</span> <span class="dv">100</span>))</span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="co">#&gt; </span></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="co">#&gt; Missing value imputation by random forests</span></span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="co">#&gt; </span></span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="co">#&gt;   Variables to impute:       Sepal.Length, Sepal.Width, Petal.Length, Petal.Width, Species</span></span>
<span id="cb4-6"><a href="#cb4-6"></a><span class="co">#&gt;   Variables used to impute:  Sepal.Length, Sepal.Width, Petal.Length, Petal.Width, Species</span></span>
<span id="cb4-7"><a href="#cb4-7"></a><span class="co">#&gt; iter 1:  .....</span></span>
<span id="cb4-8"><a href="#cb4-8"></a><span class="co">#&gt; iter 2:  .....</span></span>
<span id="cb4-9"><a href="#cb4-9"></a><span class="co">#&gt; iter 3:  .....</span></span>
<span id="cb4-10"><a href="#cb4-10"></a><span class="co">#&gt; iter 4:  .....</span></span>
<span id="cb4-11"><a href="#cb4-11"></a><span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span></span>
<span id="cb4-12"><a href="#cb4-12"></a><span class="co">#&gt; 1          5.1         3.5          1.4         0.2  setosa</span></span>
<span id="cb4-13"><a href="#cb4-13"></a><span class="co">#&gt; 2          4.9         3.0          1.4         0.2  setosa</span></span>
<span id="cb4-14"><a href="#cb4-14"></a><span class="co">#&gt; 3          4.7         3.2          1.3         0.2  setosa</span></span>
<span id="cb4-15"><a href="#cb4-15"></a><span class="co">#&gt; 4          5.8         3.1          1.5         0.2  setosa</span></span>
<span id="cb4-16"><a href="#cb4-16"></a><span class="co">#&gt; 5          5.0         3.6          1.4         0.2  setosa</span></span>
<span id="cb4-17"><a href="#cb4-17"></a><span class="co">#&gt; 6          5.4         3.9          1.4         0.4  setosa</span></span></code></pre></div>
<p>Note that <code>missRanger</code> offers a <code>...</code> argument to pass options to <code>ranger</code>, e.g. <code>num.trees</code> or <code>min.node.size</code>. How would we use its “extra trees” variant with 50 trees?</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="kw">head</span>(irisImputed_et &lt;-<span class="st"> </span><span class="kw">missRanger</span>(irisWithNA, <span class="dt">pmm.k =</span> <span class="dv">3</span>, <span class="dt">splitrule =</span> <span class="st">&quot;extratrees&quot;</span>, <span class="dt">num.trees =</span> <span class="dv">50</span>))</span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="co">#&gt; </span></span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="co">#&gt; Missing value imputation by random forests</span></span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="co">#&gt; </span></span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="co">#&gt;   Variables to impute:       Sepal.Length, Sepal.Width, Petal.Length, Petal.Width, Species</span></span>
<span id="cb5-6"><a href="#cb5-6"></a><span class="co">#&gt;   Variables used to impute:  Sepal.Length, Sepal.Width, Petal.Length, Petal.Width, Species</span></span>
<span id="cb5-7"><a href="#cb5-7"></a><span class="co">#&gt; iter 1:  .....</span></span>
<span id="cb5-8"><a href="#cb5-8"></a><span class="co">#&gt; iter 2:  .....</span></span>
<span id="cb5-9"><a href="#cb5-9"></a><span class="co">#&gt; iter 3:  .....</span></span>
<span id="cb5-10"><a href="#cb5-10"></a><span class="co">#&gt; iter 4:  .....</span></span>
<span id="cb5-11"><a href="#cb5-11"></a><span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span></span>
<span id="cb5-12"><a href="#cb5-12"></a><span class="co">#&gt; 1          5.1         3.5          1.3         0.2  setosa</span></span>
<span id="cb5-13"><a href="#cb5-13"></a><span class="co">#&gt; 2          4.9         3.0          1.4         0.2  setosa</span></span>
<span id="cb5-14"><a href="#cb5-14"></a><span class="co">#&gt; 3          4.7         3.2          1.3         0.2  setosa</span></span>
<span id="cb5-15"><a href="#cb5-15"></a><span class="co">#&gt; 4          4.8         2.7          1.3         0.2  setosa</span></span>
<span id="cb5-16"><a href="#cb5-16"></a><span class="co">#&gt; 5          5.0         3.6          1.4         0.4  setosa</span></span>
<span id="cb5-17"><a href="#cb5-17"></a><span class="co">#&gt; 6          5.4         3.9          1.3         0.4  setosa</span></span></code></pre></div>
<p>It is as simple!</p>
<p>Further note that <code>missRanger</code> does not rely on <code>tidyverse</code> but you can embed it into a <code>dplyr</code> pipeline (without <code>group_by</code>). Make sure to set <code>verbose = 0</code> in order to prevent messages.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="kw">require</span>(dplyr)</span>
<span id="cb6-2"><a href="#cb6-2"></a></span>
<span id="cb6-3"><a href="#cb6-3"></a>iris <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="st">  </span>generateNA <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb6-5"><a href="#cb6-5"></a><span class="st">  </span>as_tibble <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb6-6"><a href="#cb6-6"></a><span class="st">  </span><span class="kw">missRanger</span>(<span class="dt">verbose =</span> <span class="dv">0</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb6-7"><a href="#cb6-7"></a><span class="st">  </span>head</span>
<span id="cb6-8"><a href="#cb6-8"></a><span class="co">#&gt; # A tibble: 6 x 5</span></span>
<span id="cb6-9"><a href="#cb6-9"></a><span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span></span>
<span id="cb6-10"><a href="#cb6-10"></a><span class="co">#&gt;          &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt; &lt;fct&gt;  </span></span>
<span id="cb6-11"><a href="#cb6-11"></a><span class="co">#&gt; 1         5.1         3.5          1.4        0.310 setosa </span></span>
<span id="cb6-12"><a href="#cb6-12"></a><span class="co">#&gt; 2         4.9         3.04         1.4        0.2   setosa </span></span>
<span id="cb6-13"><a href="#cb6-13"></a><span class="co">#&gt; 3         4.7         3.2          1.3        0.2   setosa </span></span>
<span id="cb6-14"><a href="#cb6-14"></a><span class="co">#&gt; 4         4.6         3.1          1.5        0.2   setosa </span></span>
<span id="cb6-15"><a href="#cb6-15"></a><span class="co">#&gt; 5         5           3.21         1.48       0.2   setosa </span></span>
<span id="cb6-16"><a href="#cb6-16"></a><span class="co">#&gt; 6         6.69        3.9          3.08       0.4   setosa</span></span></code></pre></div>
<p>By default <code>missRanger</code> uses all columns in the data set to impute all columns with missings. To override this behaviour, you can use an intuitive formula interface: The left hand side specifies the variables to be imputed (variable names separated by a <code>+</code>), while the right hand side lists the variables used for imputation.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="co"># Impute all variables with all (default behaviour). Note that variables without</span></span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="co"># missing values will be skipped from the left hand side of the formula.</span></span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="kw">head</span>(m &lt;-<span class="st"> </span><span class="kw">missRanger</span>(irisWithNA, <span class="dt">formula =</span> . <span class="op">~</span><span class="st"> </span>., <span class="dt">pmm.k =</span> <span class="dv">3</span>, <span class="dt">num.trees =</span> <span class="dv">10</span>))</span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="co">#&gt; </span></span>
<span id="cb7-5"><a href="#cb7-5"></a><span class="co">#&gt; Missing value imputation by random forests</span></span>
<span id="cb7-6"><a href="#cb7-6"></a><span class="co">#&gt; </span></span>
<span id="cb7-7"><a href="#cb7-7"></a><span class="co">#&gt;   Variables to impute:       Sepal.Length, Sepal.Width, Petal.Length, Petal.Width, Species</span></span>
<span id="cb7-8"><a href="#cb7-8"></a><span class="co">#&gt;   Variables used to impute:  Sepal.Length, Sepal.Width, Petal.Length, Petal.Width, Species</span></span>
<span id="cb7-9"><a href="#cb7-9"></a><span class="co">#&gt; iter 1:  .....</span></span>
<span id="cb7-10"><a href="#cb7-10"></a><span class="co">#&gt; iter 2:  .....</span></span>
<span id="cb7-11"><a href="#cb7-11"></a><span class="co">#&gt; iter 3:  .....</span></span>
<span id="cb7-12"><a href="#cb7-12"></a><span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span></span>
<span id="cb7-13"><a href="#cb7-13"></a><span class="co">#&gt; 1          5.1         3.5          1.5         0.2  setosa</span></span>
<span id="cb7-14"><a href="#cb7-14"></a><span class="co">#&gt; 2          4.9         3.0          1.4         0.3  setosa</span></span>
<span id="cb7-15"><a href="#cb7-15"></a><span class="co">#&gt; 3          4.7         3.2          1.3         0.2  setosa</span></span>
<span id="cb7-16"><a href="#cb7-16"></a><span class="co">#&gt; 4          5.9         3.0          4.1         0.2  setosa</span></span>
<span id="cb7-17"><a href="#cb7-17"></a><span class="co">#&gt; 5          5.0         3.6          1.4         0.4  setosa</span></span>
<span id="cb7-18"><a href="#cb7-18"></a><span class="co">#&gt; 6          5.4         3.9          1.6         0.4  setosa</span></span>
<span id="cb7-19"><a href="#cb7-19"></a></span>
<span id="cb7-20"><a href="#cb7-20"></a><span class="co"># Same</span></span>
<span id="cb7-21"><a href="#cb7-21"></a><span class="kw">head</span>(m &lt;-<span class="st"> </span><span class="kw">missRanger</span>(irisWithNA, <span class="dt">pmm.k =</span> <span class="dv">3</span>, <span class="dt">num.trees =</span> <span class="dv">10</span>))</span>
<span id="cb7-22"><a href="#cb7-22"></a><span class="co">#&gt; </span></span>
<span id="cb7-23"><a href="#cb7-23"></a><span class="co">#&gt; Missing value imputation by random forests</span></span>
<span id="cb7-24"><a href="#cb7-24"></a><span class="co">#&gt; </span></span>
<span id="cb7-25"><a href="#cb7-25"></a><span class="co">#&gt;   Variables to impute:       Sepal.Length, Sepal.Width, Petal.Length, Petal.Width, Species</span></span>
<span id="cb7-26"><a href="#cb7-26"></a><span class="co">#&gt;   Variables used to impute:  Sepal.Length, Sepal.Width, Petal.Length, Petal.Width, Species</span></span>
<span id="cb7-27"><a href="#cb7-27"></a><span class="co">#&gt; iter 1:  .....</span></span>
<span id="cb7-28"><a href="#cb7-28"></a><span class="co">#&gt; iter 2:  .....</span></span>
<span id="cb7-29"><a href="#cb7-29"></a><span class="co">#&gt; iter 3:  .....</span></span>
<span id="cb7-30"><a href="#cb7-30"></a><span class="co">#&gt; iter 4:  .....</span></span>
<span id="cb7-31"><a href="#cb7-31"></a><span class="co">#&gt; iter 5:  .....</span></span>
<span id="cb7-32"><a href="#cb7-32"></a><span class="co">#&gt; iter 6:  .....</span></span>
<span id="cb7-33"><a href="#cb7-33"></a><span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span></span>
<span id="cb7-34"><a href="#cb7-34"></a><span class="co">#&gt; 1          5.1         3.5          1.5         0.2  setosa</span></span>
<span id="cb7-35"><a href="#cb7-35"></a><span class="co">#&gt; 2          4.9         3.0          1.4         0.5  setosa</span></span>
<span id="cb7-36"><a href="#cb7-36"></a><span class="co">#&gt; 3          4.7         3.2          1.3         0.2  setosa</span></span>
<span id="cb7-37"><a href="#cb7-37"></a><span class="co">#&gt; 4          5.5         3.4          1.9         0.2  setosa</span></span>
<span id="cb7-38"><a href="#cb7-38"></a><span class="co">#&gt; 5          5.0         3.6          1.4         0.2  setosa</span></span>
<span id="cb7-39"><a href="#cb7-39"></a><span class="co">#&gt; 6          5.4         3.9          1.4         0.4  setosa</span></span>
<span id="cb7-40"><a href="#cb7-40"></a></span>
<span id="cb7-41"><a href="#cb7-41"></a><span class="co"># Impute all variables with all except Species</span></span>
<span id="cb7-42"><a href="#cb7-42"></a><span class="kw">head</span>(m &lt;-<span class="st"> </span><span class="kw">missRanger</span>(irisWithNA, . <span class="op">~</span><span class="st"> </span>. <span class="op">-</span><span class="st"> </span>Species, <span class="dt">pmm.k =</span> <span class="dv">3</span>, <span class="dt">num.trees =</span> <span class="dv">10</span>))</span>
<span id="cb7-43"><a href="#cb7-43"></a><span class="co">#&gt; </span></span>
<span id="cb7-44"><a href="#cb7-44"></a><span class="co">#&gt; Missing value imputation by random forests</span></span>
<span id="cb7-45"><a href="#cb7-45"></a><span class="co">#&gt; </span></span>
<span id="cb7-46"><a href="#cb7-46"></a><span class="co">#&gt;   Variables to impute:       Sepal.Length, Sepal.Width, Petal.Length, Petal.Width, Species</span></span>
<span id="cb7-47"><a href="#cb7-47"></a><span class="co">#&gt;   Variables used to impute:  Sepal.Length, Sepal.Width, Petal.Length, Petal.Width</span></span>
<span id="cb7-48"><a href="#cb7-48"></a><span class="co">#&gt; iter 1:  .....</span></span>
<span id="cb7-49"><a href="#cb7-49"></a><span class="co">#&gt; iter 2:  .....</span></span>
<span id="cb7-50"><a href="#cb7-50"></a><span class="co">#&gt; iter 3:  .....</span></span>
<span id="cb7-51"><a href="#cb7-51"></a><span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span></span>
<span id="cb7-52"><a href="#cb7-52"></a><span class="co">#&gt; 1          5.1         3.5          1.3         0.2  setosa</span></span>
<span id="cb7-53"><a href="#cb7-53"></a><span class="co">#&gt; 2          4.9         3.0          1.4         0.2  setosa</span></span>
<span id="cb7-54"><a href="#cb7-54"></a><span class="co">#&gt; 3          4.7         3.2          1.3         0.2  setosa</span></span>
<span id="cb7-55"><a href="#cb7-55"></a><span class="co">#&gt; 4          6.4         3.1          3.8         0.2  setosa</span></span>
<span id="cb7-56"><a href="#cb7-56"></a><span class="co">#&gt; 5          5.0         3.6          1.4         0.1  setosa</span></span>
<span id="cb7-57"><a href="#cb7-57"></a><span class="co">#&gt; 6          5.4         3.9          1.4         0.4  setosa</span></span>
<span id="cb7-58"><a href="#cb7-58"></a></span>
<span id="cb7-59"><a href="#cb7-59"></a><span class="co"># Impute Sepal.Width by Species </span></span>
<span id="cb7-60"><a href="#cb7-60"></a><span class="kw">head</span>(m &lt;-<span class="st"> </span><span class="kw">missRanger</span>(irisWithNA, Sepal.Width <span class="op">~</span><span class="st"> </span>Species, <span class="dt">pmm.k =</span> <span class="dv">3</span>, <span class="dt">num.trees =</span> <span class="dv">10</span>))</span>
<span id="cb7-61"><a href="#cb7-61"></a><span class="co">#&gt; </span></span>
<span id="cb7-62"><a href="#cb7-62"></a><span class="co">#&gt; Missing value imputation by random forests</span></span>
<span id="cb7-63"><a href="#cb7-63"></a><span class="co">#&gt; </span></span>
<span id="cb7-64"><a href="#cb7-64"></a><span class="co">#&gt;   Variables to impute:       Sepal.Width</span></span>
<span id="cb7-65"><a href="#cb7-65"></a><span class="co">#&gt;   Variables used to impute:  </span></span>
<span id="cb7-66"><a href="#cb7-66"></a><span class="co">#&gt; iter 1:  .</span></span>
<span id="cb7-67"><a href="#cb7-67"></a><span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span></span>
<span id="cb7-68"><a href="#cb7-68"></a><span class="co">#&gt; 1          5.1         3.5           NA         0.2  setosa</span></span>
<span id="cb7-69"><a href="#cb7-69"></a><span class="co">#&gt; 2          4.9         3.0          1.4          NA  setosa</span></span>
<span id="cb7-70"><a href="#cb7-70"></a><span class="co">#&gt; 3          4.7         3.2          1.3         0.2  setosa</span></span>
<span id="cb7-71"><a href="#cb7-71"></a><span class="co">#&gt; 4           NA         3.0           NA         0.2  setosa</span></span>
<span id="cb7-72"><a href="#cb7-72"></a><span class="co">#&gt; 5          5.0         3.6          1.4          NA  setosa</span></span>
<span id="cb7-73"><a href="#cb7-73"></a><span class="co">#&gt; 6          5.4         3.9           NA         0.4  setosa</span></span>
<span id="cb7-74"><a href="#cb7-74"></a></span>
<span id="cb7-75"><a href="#cb7-75"></a><span class="co"># No success. Why? Species contains missing values and thus can only be used for imputation if it is being imputed as well</span></span>
<span id="cb7-76"><a href="#cb7-76"></a><span class="kw">head</span>(m &lt;-<span class="st"> </span><span class="kw">missRanger</span>(irisWithNA, Sepal.Width <span class="op">+</span><span class="st"> </span>Species <span class="op">~</span><span class="st"> </span>Species, <span class="dt">pmm.k =</span> <span class="dv">3</span>, <span class="dt">num.trees =</span> <span class="dv">10</span>))</span>
<span id="cb7-77"><a href="#cb7-77"></a><span class="co">#&gt; </span></span>
<span id="cb7-78"><a href="#cb7-78"></a><span class="co">#&gt; Missing value imputation by random forests</span></span>
<span id="cb7-79"><a href="#cb7-79"></a><span class="co">#&gt; </span></span>
<span id="cb7-80"><a href="#cb7-80"></a><span class="co">#&gt;   Variables to impute:       Sepal.Width, Species</span></span>
<span id="cb7-81"><a href="#cb7-81"></a><span class="co">#&gt;   Variables used to impute:  Species</span></span>
<span id="cb7-82"><a href="#cb7-82"></a><span class="co">#&gt; iter 1:  ..</span></span>
<span id="cb7-83"><a href="#cb7-83"></a><span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span></span>
<span id="cb7-84"><a href="#cb7-84"></a><span class="co">#&gt; 1          5.1         3.5           NA         0.2  setosa</span></span>
<span id="cb7-85"><a href="#cb7-85"></a><span class="co">#&gt; 2          4.9         3.0          1.4          NA  setosa</span></span>
<span id="cb7-86"><a href="#cb7-86"></a><span class="co">#&gt; 3          4.7         3.2          1.3         0.2  setosa</span></span>
<span id="cb7-87"><a href="#cb7-87"></a><span class="co">#&gt; 4           NA         3.2           NA         0.2  setosa</span></span>
<span id="cb7-88"><a href="#cb7-88"></a><span class="co">#&gt; 5          5.0         3.6          1.4          NA  setosa</span></span>
<span id="cb7-89"><a href="#cb7-89"></a><span class="co">#&gt; 6          5.4         3.9           NA         0.4  setosa</span></span>
<span id="cb7-90"><a href="#cb7-90"></a></span>
<span id="cb7-91"><a href="#cb7-91"></a><span class="co"># Impute all variables univariatly</span></span>
<span id="cb7-92"><a href="#cb7-92"></a><span class="kw">head</span>(m &lt;-<span class="st"> </span><span class="kw">missRanger</span>(irisWithNA, . <span class="op">~</span><span class="st"> </span><span class="dv">1</span>))</span>
<span id="cb7-93"><a href="#cb7-93"></a><span class="co">#&gt; </span></span>
<span id="cb7-94"><a href="#cb7-94"></a><span class="co">#&gt; Missing value imputation by random forests</span></span>
<span id="cb7-95"><a href="#cb7-95"></a><span class="co">#&gt; </span></span>
<span id="cb7-96"><a href="#cb7-96"></a><span class="co">#&gt;   Variables to impute:       Sepal.Length, Sepal.Width, Petal.Length, Petal.Width, Species</span></span>
<span id="cb7-97"><a href="#cb7-97"></a><span class="co">#&gt;   Variables used to impute:  </span></span>
<span id="cb7-98"><a href="#cb7-98"></a><span class="co">#&gt; iter 1:  .....</span></span>
<span id="cb7-99"><a href="#cb7-99"></a><span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span></span>
<span id="cb7-100"><a href="#cb7-100"></a><span class="co">#&gt; 1          5.1         3.5          1.9         0.2  setosa</span></span>
<span id="cb7-101"><a href="#cb7-101"></a><span class="co">#&gt; 2          4.9         3.0          1.4         2.0  setosa</span></span>
<span id="cb7-102"><a href="#cb7-102"></a><span class="co">#&gt; 3          4.7         3.2          1.3         0.2  setosa</span></span>
<span id="cb7-103"><a href="#cb7-103"></a><span class="co">#&gt; 4          4.6         4.1          5.6         0.2  setosa</span></span>
<span id="cb7-104"><a href="#cb7-104"></a><span class="co">#&gt; 5          5.0         3.6          1.4         0.2  setosa</span></span>
<span id="cb7-105"><a href="#cb7-105"></a><span class="co">#&gt; 6          5.4         3.9          5.9         0.4  setosa</span></span></code></pre></div>
</div>
<div id="imputation-takes-too-much-time.-what-can-i-do" class="section level2">
<h2>Imputation takes too much time. What can I do?</h2>
<p><code>missRanger</code> is based on iteratively fitting random forests for each variable with missing values. Since the underlying random forest implementation <code>ranger</code> uses 500 trees per default, a huge number of trees might be calculated. For larger data sets, the overall process can take very long.</p>
<p>Here are tweaks to make things faster:</p>
<ul>
<li><p>Use less trees, e.g. by setting <code>num.trees = 50</code>. Even one single tree might be sufficient. Typically, the number of iterations until convergence will increase with fewer trees though.</p></li>
<li><p>Use smaller bootstrap samples by setting e.g. <code>sample.fraction = 0.1</code>.</p></li>
<li><p>Use the less greedy <code>splitrule = &quot;extratrees&quot;</code>.</p></li>
<li><p>Use a low tree depth <code>max.depth = 6</code>.</p></li>
<li><p>Use large leafs, e.g. <code>min.node.size = 10000</code>.</p></li>
<li><p>Use a low <code>max.iter</code>, e.g. 1 or 2.</p></li>
</ul>
<div id="examples-evaluated-on-a-normal-laptop-not-run-here" class="section level3">
<h3>Examples evaluated on a normal laptop (not run here)</h3>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="kw">require</span>(ggplot2) <span class="co"># for diamonds data</span></span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="kw">dim</span>(diamonds) <span class="co"># 53940    10</span></span>
<span id="cb8-3"><a href="#cb8-3"></a></span>
<span id="cb8-4"><a href="#cb8-4"></a>diamonds_with_NA &lt;-<span class="st"> </span><span class="kw">generateNA</span>(diamonds)</span>
<span id="cb8-5"><a href="#cb8-5"></a></span>
<span id="cb8-6"><a href="#cb8-6"></a><span class="co"># Takes 270 seconds (10 * 500 trees per iteration!)</span></span>
<span id="cb8-7"><a href="#cb8-7"></a><span class="kw">system.time</span>(m &lt;-<span class="st"> </span><span class="kw">missRanger</span>(diamonds_with_NA, <span class="dt">pmm.k =</span> <span class="dv">3</span>))</span>
<span id="cb8-8"><a href="#cb8-8"></a></span>
<span id="cb8-9"><a href="#cb8-9"></a><span class="co"># Takes 19 seconds</span></span>
<span id="cb8-10"><a href="#cb8-10"></a><span class="kw">system.time</span>(m &lt;-<span class="st"> </span><span class="kw">missRanger</span>(diamonds_with_NA, <span class="dt">pmm.k =</span> <span class="dv">3</span>, <span class="dt">num.trees =</span> <span class="dv">50</span>))</span>
<span id="cb8-11"><a href="#cb8-11"></a></span>
<span id="cb8-12"><a href="#cb8-12"></a><span class="co"># Takes 7 seconds</span></span>
<span id="cb8-13"><a href="#cb8-13"></a><span class="kw">system.time</span>(m &lt;-<span class="st"> </span><span class="kw">missRanger</span>(diamonds_with_NA, <span class="dt">pmm.k =</span> <span class="dv">3</span>, <span class="dt">num.trees =</span> <span class="dv">1</span>))</span>
<span id="cb8-14"><a href="#cb8-14"></a></span>
<span id="cb8-15"><a href="#cb8-15"></a><span class="co"># Takes 9 seconds</span></span>
<span id="cb8-16"><a href="#cb8-16"></a><span class="kw">system.time</span>(m &lt;-<span class="st"> </span><span class="kw">missRanger</span>(diamonds_with_NA, <span class="dt">pmm.k =</span> <span class="dv">3</span>, <span class="dt">num.trees =</span> <span class="dv">50</span>, <span class="dt">sample.fraction =</span> <span class="fl">0.1</span>))</span></code></pre></div>
</div>
</div>
<div id="trick-use-case.weights-to-weight-down-contribution-of-rows-with-many-missings" class="section level2">
<h2>Trick: Use <code>case.weights</code> to weight down contribution of rows with many missings</h2>
<p>Using the <code>case.weights</code> argument, you can pass case weights to the imputation models. This might be e.g. useful to weight down the contribution of rows with many missings.</p>
<div id="example" class="section level3">
<h3>Example</h3>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="co"># Count the number of non-missing values per row</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>non_miss &lt;-<span class="st"> </span><span class="kw">rowSums</span>(<span class="op">!</span><span class="kw">is.na</span>(irisWithNA))</span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="kw">table</span>(non_miss)</span>
<span id="cb9-4"><a href="#cb9-4"></a><span class="co">#&gt; non_miss</span></span>
<span id="cb9-5"><a href="#cb9-5"></a><span class="co">#&gt;  1  2  3  4  5 </span></span>
<span id="cb9-6"><a href="#cb9-6"></a><span class="co">#&gt;  2  6 28 68 46</span></span>
<span id="cb9-7"><a href="#cb9-7"></a></span>
<span id="cb9-8"><a href="#cb9-8"></a><span class="co"># No weighting</span></span>
<span id="cb9-9"><a href="#cb9-9"></a><span class="kw">head</span>(m &lt;-<span class="st"> </span><span class="kw">missRanger</span>(irisWithNA, <span class="dt">num.trees =</span> <span class="dv">20</span>, <span class="dt">pmm.k =</span> <span class="dv">3</span>, <span class="dt">seed =</span> <span class="dv">5</span>))</span>
<span id="cb9-10"><a href="#cb9-10"></a><span class="co">#&gt; </span></span>
<span id="cb9-11"><a href="#cb9-11"></a><span class="co">#&gt; Missing value imputation by random forests</span></span>
<span id="cb9-12"><a href="#cb9-12"></a><span class="co">#&gt; </span></span>
<span id="cb9-13"><a href="#cb9-13"></a><span class="co">#&gt;   Variables to impute:       Sepal.Length, Sepal.Width, Petal.Length, Petal.Width, Species</span></span>
<span id="cb9-14"><a href="#cb9-14"></a><span class="co">#&gt;   Variables used to impute:  Sepal.Length, Sepal.Width, Petal.Length, Petal.Width, Species</span></span>
<span id="cb9-15"><a href="#cb9-15"></a><span class="co">#&gt; iter 1:  .....</span></span>
<span id="cb9-16"><a href="#cb9-16"></a><span class="co">#&gt; iter 2:  .....</span></span>
<span id="cb9-17"><a href="#cb9-17"></a><span class="co">#&gt; iter 3:  .....</span></span>
<span id="cb9-18"><a href="#cb9-18"></a><span class="co">#&gt; iter 4:  .....</span></span>
<span id="cb9-19"><a href="#cb9-19"></a><span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span></span>
<span id="cb9-20"><a href="#cb9-20"></a><span class="co">#&gt; 1          5.1         3.5          1.5         0.2  setosa</span></span>
<span id="cb9-21"><a href="#cb9-21"></a><span class="co">#&gt; 2          4.9         3.0          1.4         0.1  setosa</span></span>
<span id="cb9-22"><a href="#cb9-22"></a><span class="co">#&gt; 3          4.7         3.2          1.3         0.2  setosa</span></span>
<span id="cb9-23"><a href="#cb9-23"></a><span class="co">#&gt; 4          5.7         3.8          1.5         0.2  setosa</span></span>
<span id="cb9-24"><a href="#cb9-24"></a><span class="co">#&gt; 5          5.0         3.6          1.4         0.2  setosa</span></span>
<span id="cb9-25"><a href="#cb9-25"></a><span class="co">#&gt; 6          5.4         3.9          1.5         0.4  setosa</span></span>
<span id="cb9-26"><a href="#cb9-26"></a></span>
<span id="cb9-27"><a href="#cb9-27"></a><span class="co"># Weighted by number of non-missing values per row. </span></span>
<span id="cb9-28"><a href="#cb9-28"></a><span class="kw">head</span>(m &lt;-<span class="st"> </span><span class="kw">missRanger</span>(irisWithNA, <span class="dt">num.trees =</span> <span class="dv">20</span>, <span class="dt">pmm.k =</span> <span class="dv">3</span>, <span class="dt">seed =</span> <span class="dv">5</span>, <span class="dt">case.weights =</span> non_miss))</span>
<span id="cb9-29"><a href="#cb9-29"></a><span class="co">#&gt; </span></span>
<span id="cb9-30"><a href="#cb9-30"></a><span class="co">#&gt; Missing value imputation by random forests</span></span>
<span id="cb9-31"><a href="#cb9-31"></a><span class="co">#&gt; </span></span>
<span id="cb9-32"><a href="#cb9-32"></a><span class="co">#&gt;   Variables to impute:       Sepal.Length, Sepal.Width, Petal.Length, Petal.Width, Species</span></span>
<span id="cb9-33"><a href="#cb9-33"></a><span class="co">#&gt;   Variables used to impute:  Sepal.Length, Sepal.Width, Petal.Length, Petal.Width, Species</span></span>
<span id="cb9-34"><a href="#cb9-34"></a><span class="co">#&gt; iter 1:  .....</span></span>
<span id="cb9-35"><a href="#cb9-35"></a><span class="co">#&gt; iter 2:  .....</span></span>
<span id="cb9-36"><a href="#cb9-36"></a><span class="co">#&gt; iter 3:  .....</span></span>
<span id="cb9-37"><a href="#cb9-37"></a><span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span></span>
<span id="cb9-38"><a href="#cb9-38"></a><span class="co">#&gt; 1          5.1         3.5          1.3         0.2  setosa</span></span>
<span id="cb9-39"><a href="#cb9-39"></a><span class="co">#&gt; 2          4.9         3.0          1.4         0.1  setosa</span></span>
<span id="cb9-40"><a href="#cb9-40"></a><span class="co">#&gt; 3          4.7         3.2          1.3         0.2  setosa</span></span>
<span id="cb9-41"><a href="#cb9-41"></a><span class="co">#&gt; 4          5.4         3.4          1.4         0.2  setosa</span></span>
<span id="cb9-42"><a href="#cb9-42"></a><span class="co">#&gt; 5          5.0         3.6          1.4         0.2  setosa</span></span>
<span id="cb9-43"><a href="#cb9-43"></a><span class="co">#&gt; 6          5.4         3.9          1.1         0.4  setosa</span></span></code></pre></div>
</div>
</div>
<div id="how-to-use-missranger-in-multiple-imputation-settings" class="section level2">
<h2>How to use <code>missRanger</code> in multiple imputation settings?</h2>
<p>For machine learning tasks, imputation is typically seen as a fixed data preparation step like dummy coding. There, multiple imputation is rarely applied as it adds another level of complexity to the analysis. This might be fine since a good validation schema will account for variation introduced by imputation.</p>
<p>For tasks with focus on statistical inference (p values, standard errors, confidence intervals, estimation of effects), the extra variability introduced by imputation has to be accounted for except if only very few missing values appear. One of the standard approaches is to impute the data set multiple times, generating e.g. 10 or 100 versions of a complete data set. Then, the intended analysis (t-test, linear model etc.) is applied independently to each of the complete data sets. Their results are combined afterward in a pooling step, usually by Rubin’s rule [4]. For parameter estimates, averages are taken. Their variance is basically a combination of the average squared standard errors plus the variance of the parameter estimates across the imputed data sets, leading to inflated standard errors and thus larger p values and wider confidence intervals.</p>
<p>The package <code>mice</code> [3] takes case of this pooling step. The creation of multiple complete data sets can be done by <code>mice</code> or also by <code>missRanger</code>. In the latter case, in order to keep the variance of imputed values at a realistic level, we suggest to use predictive mean matching on top of the random forest imputations.</p>
<p>The following example shows how easy such workflow looks like.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>irisWithNA &lt;-<span class="st"> </span><span class="kw">generateNA</span>(iris, <span class="dt">p =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>))</span>
<span id="cb10-2"><a href="#cb10-2"></a></span>
<span id="cb10-3"><a href="#cb10-3"></a><span class="co"># Generate 20 complete data sets</span></span>
<span id="cb10-4"><a href="#cb10-4"></a>filled &lt;-<span class="st"> </span><span class="kw">replicate</span>(<span class="dv">20</span>, <span class="kw">missRanger</span>(irisWithNA, <span class="dt">verbose =</span> <span class="dv">0</span>, <span class="dt">num.trees =</span> <span class="dv">100</span>, <span class="dt">pmm.k =</span> <span class="dv">5</span>), <span class="dt">simplify =</span> <span class="ot">FALSE</span>)</span>
<span id="cb10-5"><a href="#cb10-5"></a>                           </span>
<span id="cb10-6"><a href="#cb10-6"></a><span class="co"># Run a linear model for each of the completed data sets                          </span></span>
<span id="cb10-7"><a href="#cb10-7"></a>models &lt;-<span class="st"> </span><span class="kw">lapply</span>(filled, <span class="cf">function</span>(x) <span class="kw">lm</span>(Sepal.Length <span class="op">~</span><span class="st"> </span>., x))</span>
<span id="cb10-8"><a href="#cb10-8"></a></span>
<span id="cb10-9"><a href="#cb10-9"></a><span class="co"># Pool the results by mice</span></span>
<span id="cb10-10"><a href="#cb10-10"></a><span class="kw">require</span>(mice)</span>
<span id="cb10-11"><a href="#cb10-11"></a><span class="kw">summary</span>(pooled_fit &lt;-<span class="st"> </span><span class="kw">pool</span>(models))</span>
<span id="cb10-12"><a href="#cb10-12"></a><span class="co">#&gt;                     estimate  std.error statistic       df      p.value</span></span>
<span id="cb10-13"><a href="#cb10-13"></a><span class="co">#&gt; (Intercept)        2.3237581 0.31344494  7.413609 79.09153 1.191021e-10</span></span>
<span id="cb10-14"><a href="#cb10-14"></a><span class="co">#&gt; Sepal.Width        0.4820868 0.09965924  4.837352 70.91717 7.413834e-06</span></span>
<span id="cb10-15"><a href="#cb10-15"></a><span class="co">#&gt; Petal.Length       0.7602107 0.07799618  9.746768 75.59176 5.329071e-15</span></span>
<span id="cb10-16"><a href="#cb10-16"></a><span class="co">#&gt; Petal.Width       -0.2594143 0.15886858 -1.632886 77.07308 1.065721e-01</span></span>
<span id="cb10-17"><a href="#cb10-17"></a><span class="co">#&gt; Speciesversicolor -0.6312472 0.27946995 -2.258730 59.13447 2.760202e-02</span></span>
<span id="cb10-18"><a href="#cb10-18"></a><span class="co">#&gt; Speciesvirginica  -0.8448732 0.38541621 -2.192106 59.56188 3.229175e-02</span></span>
<span id="cb10-19"><a href="#cb10-19"></a></span>
<span id="cb10-20"><a href="#cb10-20"></a><span class="co"># Compare with model on original data</span></span>
<span id="cb10-21"><a href="#cb10-21"></a><span class="kw">summary</span>(<span class="kw">lm</span>(Sepal.Length <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> iris))</span>
<span id="cb10-22"><a href="#cb10-22"></a><span class="co">#&gt; </span></span>
<span id="cb10-23"><a href="#cb10-23"></a><span class="co">#&gt; Call:</span></span>
<span id="cb10-24"><a href="#cb10-24"></a><span class="co">#&gt; lm(formula = Sepal.Length ~ ., data = iris)</span></span>
<span id="cb10-25"><a href="#cb10-25"></a><span class="co">#&gt; </span></span>
<span id="cb10-26"><a href="#cb10-26"></a><span class="co">#&gt; Residuals:</span></span>
<span id="cb10-27"><a href="#cb10-27"></a><span class="co">#&gt;      Min       1Q   Median       3Q      Max </span></span>
<span id="cb10-28"><a href="#cb10-28"></a><span class="co">#&gt; -0.79424 -0.21874  0.00899  0.20255  0.73103 </span></span>
<span id="cb10-29"><a href="#cb10-29"></a><span class="co">#&gt; </span></span>
<span id="cb10-30"><a href="#cb10-30"></a><span class="co">#&gt; Coefficients:</span></span>
<span id="cb10-31"><a href="#cb10-31"></a><span class="co">#&gt;                   Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span id="cb10-32"><a href="#cb10-32"></a><span class="co">#&gt; (Intercept)        2.17127    0.27979   7.760 1.43e-12 ***</span></span>
<span id="cb10-33"><a href="#cb10-33"></a><span class="co">#&gt; Sepal.Width        0.49589    0.08607   5.761 4.87e-08 ***</span></span>
<span id="cb10-34"><a href="#cb10-34"></a><span class="co">#&gt; Petal.Length       0.82924    0.06853  12.101  &lt; 2e-16 ***</span></span>
<span id="cb10-35"><a href="#cb10-35"></a><span class="co">#&gt; Petal.Width       -0.31516    0.15120  -2.084  0.03889 *  </span></span>
<span id="cb10-36"><a href="#cb10-36"></a><span class="co">#&gt; Speciesversicolor -0.72356    0.24017  -3.013  0.00306 ** </span></span>
<span id="cb10-37"><a href="#cb10-37"></a><span class="co">#&gt; Speciesvirginica  -1.02350    0.33373  -3.067  0.00258 ** </span></span>
<span id="cb10-38"><a href="#cb10-38"></a><span class="co">#&gt; ---</span></span>
<span id="cb10-39"><a href="#cb10-39"></a><span class="co">#&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb10-40"><a href="#cb10-40"></a><span class="co">#&gt; </span></span>
<span id="cb10-41"><a href="#cb10-41"></a><span class="co">#&gt; Residual standard error: 0.3068 on 144 degrees of freedom</span></span>
<span id="cb10-42"><a href="#cb10-42"></a><span class="co">#&gt; Multiple R-squared:  0.8673, Adjusted R-squared:  0.8627 </span></span>
<span id="cb10-43"><a href="#cb10-43"></a><span class="co">#&gt; F-statistic: 188.3 on 5 and 144 DF,  p-value: &lt; 2.2e-16</span></span></code></pre></div>
<p>The standard errors and p values of the multiple imputation are larger than of the original data set. This reflects the additional uncertainty introduced by the presence of missing values in a realistic way.</p>
</div>
<div id="how-to-deal-with-censored-variables" class="section level2">
<h2>How to deal with censored variables?</h2>
<p>There is no obvious way of how to deal with survival variables as covariables in imputation models.</p>
<p>Options discussed in White [5] include:</p>
<ul>
<li><p>Use both status variable s and (censored) time variable t</p></li>
<li><p>s and log(t)</p></li>
<li><p>surv(t), and, optionally s</p></li>
</ul>
<p>By surv(t), we denote the Nelson-Aalen survival estimate at each value of t. The third option is the most elegant one as it explicitly deals with censoring information. We provide some additional details on it in the example</p>
<div id="example-1" class="section level3">
<h3>Example</h3>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="kw">require</span>(survival)</span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="kw">require</span>(dplyr)</span>
<span id="cb11-3"><a href="#cb11-3"></a><span class="kw">head</span>(veteran)</span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="co">#&gt;   trt celltype time status karno diagtime age prior</span></span>
<span id="cb11-5"><a href="#cb11-5"></a><span class="co">#&gt; 1   1 squamous   72      1    60        7  69     0</span></span>
<span id="cb11-6"><a href="#cb11-6"></a><span class="co">#&gt; 2   1 squamous  411      1    70        5  64    10</span></span>
<span id="cb11-7"><a href="#cb11-7"></a><span class="co">#&gt; 3   1 squamous  228      1    60        3  38     0</span></span>
<span id="cb11-8"><a href="#cb11-8"></a><span class="co">#&gt; 4   1 squamous  126      1    60        9  63    10</span></span>
<span id="cb11-9"><a href="#cb11-9"></a><span class="co">#&gt; 5   1 squamous  118      1    70       11  65    10</span></span>
<span id="cb11-10"><a href="#cb11-10"></a><span class="co">#&gt; 6   1 squamous   10      1    20        5  49     0</span></span>
<span id="cb11-11"><a href="#cb11-11"></a><span class="kw">set.seed</span>(<span class="dv">653</span>)</span>
<span id="cb11-12"><a href="#cb11-12"></a></span>
<span id="cb11-13"><a href="#cb11-13"></a><span class="co"># For illustration, we use data from a randomized two-arm trial </span></span>
<span id="cb11-14"><a href="#cb11-14"></a><span class="co"># about lung cancer. The aim is to estimate the treatment effect</span></span>
<span id="cb11-15"><a href="#cb11-15"></a><span class="co"># of &quot;trt&quot; with reliable inference using Cox regression. Unfortunately, </span></span>
<span id="cb11-16"><a href="#cb11-16"></a><span class="co"># we generated missing values in the covariables &quot;age&quot; and &quot;karno&quot; (performance</span></span>
<span id="cb11-17"><a href="#cb11-17"></a><span class="co"># status). One approach is to use multiple imputation, see the section above.</span></span>
<span id="cb11-18"><a href="#cb11-18"></a><span class="co"># It is recommended to use the model response in the imputation models - </span></span>
<span id="cb11-19"><a href="#cb11-19"></a><span class="co"># even if it sounds wrong. In case of a censored survival response</span></span>
<span id="cb11-20"><a href="#cb11-20"></a><span class="co"># (i.e. consisting of a time/status pair), an elegant </span></span>
<span id="cb11-21"><a href="#cb11-21"></a><span class="co"># possibility is to represent it by the estimated Nelson-Aalen estimates [5].</span></span>
<span id="cb11-22"><a href="#cb11-22"></a></span>
<span id="cb11-23"><a href="#cb11-23"></a><span class="co"># Add the Nelson-Aalen survival probabilities &quot;surv&quot; to the data set</span></span>
<span id="cb11-24"><a href="#cb11-24"></a>veteran2 &lt;-<span class="st"> </span><span class="kw">summary</span>(<span class="kw">survfit</span>(<span class="kw">Surv</span>(time, status) <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">data =</span> veteran), </span>
<span id="cb11-25"><a href="#cb11-25"></a>                <span class="dt">times =</span> veteran<span class="op">$</span>time)[<span class="kw">c</span>(<span class="st">&quot;time&quot;</span>, <span class="st">&quot;surv&quot;</span>)] <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb11-26"><a href="#cb11-26"></a><span class="st">            </span>as_tibble <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb11-27"><a href="#cb11-27"></a><span class="st">            </span><span class="kw">right_join</span>(veteran, <span class="dt">by =</span> <span class="st">&quot;time&quot;</span>)</span>
<span id="cb11-28"><a href="#cb11-28"></a></span>
<span id="cb11-29"><a href="#cb11-29"></a><span class="co"># Add missing values to some columns. We do not add missing values</span></span>
<span id="cb11-30"><a href="#cb11-30"></a><span class="co"># in the survival information as this is usually the response of the (Cox-) </span></span>
<span id="cb11-31"><a href="#cb11-31"></a><span class="co"># modelling process following the imputation.</span></span>
<span id="cb11-32"><a href="#cb11-32"></a></span>
<span id="cb11-33"><a href="#cb11-33"></a>veteran_with_NA &lt;-<span class="st"> </span><span class="kw">generateNA</span>(veteran2, <span class="dt">p =</span> <span class="kw">c</span>(<span class="dt">age =</span> <span class="fl">0.1</span>, <span class="dt">karno =</span> <span class="fl">0.1</span>, <span class="dt">diagtime =</span> <span class="fl">0.1</span>))</span>
<span id="cb11-34"><a href="#cb11-34"></a></span>
<span id="cb11-35"><a href="#cb11-35"></a><span class="co"># Generate 20 complete data sets and remove &quot;surv&quot;</span></span>
<span id="cb11-36"><a href="#cb11-36"></a>filled &lt;-<span class="st"> </span><span class="kw">replicate</span>(<span class="dv">20</span>, <span class="kw">missRanger</span>(veteran_with_NA, . <span class="op">~</span><span class="st"> </span>. <span class="op">-</span><span class="st"> </span>time <span class="op">-</span><span class="st"> </span>status, </span>
<span id="cb11-37"><a href="#cb11-37"></a>  <span class="dt">verbose =</span> <span class="dv">0</span>, <span class="dt">pmm.k =</span> <span class="dv">3</span>, <span class="dt">num.trees =</span> <span class="dv">50</span>), <span class="dt">simplify =</span> <span class="ot">FALSE</span>)</span>
<span id="cb11-38"><a href="#cb11-38"></a></span>
<span id="cb11-39"><a href="#cb11-39"></a>filled &lt;-<span class="st"> </span><span class="kw">lapply</span>(filled, <span class="cf">function</span>(data) {data<span class="op">$</span>surv &lt;-<span class="st"> </span><span class="ot">NULL</span>; data})</span>
<span id="cb11-40"><a href="#cb11-40"></a></span>
<span id="cb11-41"><a href="#cb11-41"></a><span class="co"># Run a Cox proportional hazards regression for each of the completed data sets</span></span>
<span id="cb11-42"><a href="#cb11-42"></a>models &lt;-<span class="st"> </span><span class="kw">lapply</span>(filled, <span class="cf">function</span>(x) <span class="kw">coxph</span>(<span class="kw">Surv</span>(time, status) <span class="op">~</span><span class="st"> </span>., x))</span>
<span id="cb11-43"><a href="#cb11-43"></a></span>
<span id="cb11-44"><a href="#cb11-44"></a><span class="co"># Pool the results by mice</span></span>
<span id="cb11-45"><a href="#cb11-45"></a><span class="kw">require</span>(mice)</span>
<span id="cb11-46"><a href="#cb11-46"></a><span class="kw">summary</span>(pooled_fit &lt;-<span class="st"> </span><span class="kw">pool</span>(models))</span>
<span id="cb11-47"><a href="#cb11-47"></a><span class="co">#&gt;                       estimate   std.error  statistic        df</span></span>
<span id="cb11-48"><a href="#cb11-48"></a><span class="co">#&gt; trt                0.201959473 0.159267360  1.2680531  6176.473</span></span>
<span id="cb11-49"><a href="#cb11-49"></a><span class="co">#&gt; celltypesmallcell  0.836528671 0.214067771  3.9077749 53541.171</span></span>
<span id="cb11-50"><a href="#cb11-50"></a><span class="co">#&gt; celltypeadeno      1.079369471 0.238737193  4.5211618  5714.099</span></span>
<span id="cb11-51"><a href="#cb11-51"></a><span class="co">#&gt; celltypelarge      0.327385574 0.243147111  1.3464506  5849.810</span></span>
<span id="cb11-52"><a href="#cb11-52"></a><span class="co">#&gt; karno             -0.035056963 0.004379610 -8.0045848  2621.609</span></span>
<span id="cb11-53"><a href="#cb11-53"></a><span class="co">#&gt; diagtime          -0.003081890 0.006138537 -0.5020561 10297.018</span></span>
<span id="cb11-54"><a href="#cb11-54"></a><span class="co">#&gt; age               -0.005642109 0.007954351 -0.7093111   775.675</span></span>
<span id="cb11-55"><a href="#cb11-55"></a><span class="co">#&gt; prior              0.007778027 0.018826526  0.4131419 12385.627</span></span>
<span id="cb11-56"><a href="#cb11-56"></a><span class="co">#&gt;                        p.value</span></span>
<span id="cb11-57"><a href="#cb11-57"></a><span class="co">#&gt; trt               2.048268e-01</span></span>
<span id="cb11-58"><a href="#cb11-58"></a><span class="co">#&gt; celltypesmallcell 9.326449e-05</span></span>
<span id="cb11-59"><a href="#cb11-59"></a><span class="co">#&gt; celltypeadeno     6.274303e-06</span></span>
<span id="cb11-60"><a href="#cb11-60"></a><span class="co">#&gt; celltypelarge     1.782094e-01</span></span>
<span id="cb11-61"><a href="#cb11-61"></a><span class="co">#&gt; karno             1.776357e-15</span></span>
<span id="cb11-62"><a href="#cb11-62"></a><span class="co">#&gt; diagtime          6.156388e-01</span></span>
<span id="cb11-63"><a href="#cb11-63"></a><span class="co">#&gt; age               4.783446e-01</span></span>
<span id="cb11-64"><a href="#cb11-64"></a><span class="co">#&gt; prior             6.795098e-01</span></span>
<span id="cb11-65"><a href="#cb11-65"></a></span>
<span id="cb11-66"><a href="#cb11-66"></a><span class="co"># On the original</span></span>
<span id="cb11-67"><a href="#cb11-67"></a><span class="kw">summary</span>(<span class="kw">coxph</span>(<span class="kw">Surv</span>(time, status) <span class="op">~</span><span class="st"> </span>., veteran))</span>
<span id="cb11-68"><a href="#cb11-68"></a><span class="co">#&gt; Call:</span></span>
<span id="cb11-69"><a href="#cb11-69"></a><span class="co">#&gt; coxph(formula = Surv(time, status) ~ ., data = veteran)</span></span>
<span id="cb11-70"><a href="#cb11-70"></a><span class="co">#&gt; </span></span>
<span id="cb11-71"><a href="#cb11-71"></a><span class="co">#&gt;   n= 137, number of events= 128 </span></span>
<span id="cb11-72"><a href="#cb11-72"></a><span class="co">#&gt; </span></span>
<span id="cb11-73"><a href="#cb11-73"></a><span class="co">#&gt;                         coef  exp(coef)   se(coef)      z Pr(&gt;|z|)    </span></span>
<span id="cb11-74"><a href="#cb11-74"></a><span class="co">#&gt; trt                2.946e-01  1.343e+00  2.075e-01  1.419  0.15577    </span></span>
<span id="cb11-75"><a href="#cb11-75"></a><span class="co">#&gt; celltypesmallcell  8.616e-01  2.367e+00  2.753e-01  3.130  0.00175 ** </span></span>
<span id="cb11-76"><a href="#cb11-76"></a><span class="co">#&gt; celltypeadeno      1.196e+00  3.307e+00  3.009e-01  3.975 7.05e-05 ***</span></span>
<span id="cb11-77"><a href="#cb11-77"></a><span class="co">#&gt; celltypelarge      4.013e-01  1.494e+00  2.827e-01  1.420  0.15574    </span></span>
<span id="cb11-78"><a href="#cb11-78"></a><span class="co">#&gt; karno             -3.282e-02  9.677e-01  5.508e-03 -5.958 2.55e-09 ***</span></span>
<span id="cb11-79"><a href="#cb11-79"></a><span class="co">#&gt; diagtime           8.132e-05  1.000e+00  9.136e-03  0.009  0.99290    </span></span>
<span id="cb11-80"><a href="#cb11-80"></a><span class="co">#&gt; age               -8.706e-03  9.913e-01  9.300e-03 -0.936  0.34920    </span></span>
<span id="cb11-81"><a href="#cb11-81"></a><span class="co">#&gt; prior              7.159e-03  1.007e+00  2.323e-02  0.308  0.75794    </span></span>
<span id="cb11-82"><a href="#cb11-82"></a><span class="co">#&gt; ---</span></span>
<span id="cb11-83"><a href="#cb11-83"></a><span class="co">#&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb11-84"><a href="#cb11-84"></a><span class="co">#&gt; </span></span>
<span id="cb11-85"><a href="#cb11-85"></a><span class="co">#&gt;                   exp(coef) exp(-coef) lower .95 upper .95</span></span>
<span id="cb11-86"><a href="#cb11-86"></a><span class="co">#&gt; trt                  1.3426     0.7448    0.8939    2.0166</span></span>
<span id="cb11-87"><a href="#cb11-87"></a><span class="co">#&gt; celltypesmallcell    2.3669     0.4225    1.3799    4.0597</span></span>
<span id="cb11-88"><a href="#cb11-88"></a><span class="co">#&gt; celltypeadeno        3.3071     0.3024    1.8336    5.9647</span></span>
<span id="cb11-89"><a href="#cb11-89"></a><span class="co">#&gt; celltypelarge        1.4938     0.6695    0.8583    2.5996</span></span>
<span id="cb11-90"><a href="#cb11-90"></a><span class="co">#&gt; karno                0.9677     1.0334    0.9573    0.9782</span></span>
<span id="cb11-91"><a href="#cb11-91"></a><span class="co">#&gt; diagtime             1.0001     0.9999    0.9823    1.0182</span></span>
<span id="cb11-92"><a href="#cb11-92"></a><span class="co">#&gt; age                  0.9913     1.0087    0.9734    1.0096</span></span>
<span id="cb11-93"><a href="#cb11-93"></a><span class="co">#&gt; prior                1.0072     0.9929    0.9624    1.0541</span></span>
<span id="cb11-94"><a href="#cb11-94"></a><span class="co">#&gt; </span></span>
<span id="cb11-95"><a href="#cb11-95"></a><span class="co">#&gt; Concordance= 0.736  (se = 0.021 )</span></span>
<span id="cb11-96"><a href="#cb11-96"></a><span class="co">#&gt; Likelihood ratio test= 62.1  on 8 df,   p=2e-10</span></span>
<span id="cb11-97"><a href="#cb11-97"></a><span class="co">#&gt; Wald test            = 62.37  on 8 df,   p=2e-10</span></span>
<span id="cb11-98"><a href="#cb11-98"></a><span class="co">#&gt; Score (logrank) test = 66.74  on 8 df,   p=2e-11</span></span></code></pre></div>
</div>
</div>
<div id="how-to-deal-with-date-variables-etc." class="section level2">
<h2>How to deal with date variables etc.?</h2>
<p>Originally, <code>missRanger</code> could deal only with factors and numeric variables. Since Release 2.1.0, most reasonable types are supported, including dates, date times etc. If there are problems with some special column type, you still have the option to convert it yourself or exclude it by the formula interface explained above.</p>
<div id="example-2" class="section level3">
<h3>Example</h3>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>ir &lt;-<span class="st"> </span>iris</span>
<span id="cb12-2"><a href="#cb12-2"></a>ir<span class="op">$</span>s &lt;-<span class="st"> </span>iris<span class="op">$</span>Species <span class="op">==</span><span class="st"> &quot;setosa&quot;</span></span>
<span id="cb12-3"><a href="#cb12-3"></a>ir<span class="op">$</span>dt &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="kw">Sys.time</span>(), <span class="dt">by =</span> <span class="st">&quot;1 min&quot;</span>, <span class="dt">length.out =</span> <span class="dv">150</span>)</span>
<span id="cb12-4"><a href="#cb12-4"></a>ir<span class="op">$</span>d &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="kw">Sys.Date</span>(), <span class="dt">by =</span> <span class="st">&quot;1 d&quot;</span>, <span class="dt">length.out =</span> <span class="dv">150</span>)</span>
<span id="cb12-5"><a href="#cb12-5"></a>ir<span class="op">$</span>ch &lt;-<span class="st"> </span><span class="kw">as.character</span>(iris<span class="op">$</span>Species)</span>
<span id="cb12-6"><a href="#cb12-6"></a><span class="kw">head</span>(ir &lt;-<span class="st"> </span><span class="kw">generateNA</span>(ir, <span class="kw">c</span>(<span class="kw">rep</span>(<span class="fl">0.2</span>, <span class="dv">7</span>), <span class="dv">0</span>, <span class="dv">0</span>)))</span>
<span id="cb12-7"><a href="#cb12-7"></a><span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species    s</span></span>
<span id="cb12-8"><a href="#cb12-8"></a><span class="co">#&gt; 1          5.1         3.5          1.4         0.2  setosa TRUE</span></span>
<span id="cb12-9"><a href="#cb12-9"></a><span class="co">#&gt; 2          4.9         3.0          1.4          NA  setosa TRUE</span></span>
<span id="cb12-10"><a href="#cb12-10"></a><span class="co">#&gt; 3          4.7         3.2          1.3         0.2  setosa TRUE</span></span>
<span id="cb12-11"><a href="#cb12-11"></a><span class="co">#&gt; 4          4.6         3.1           NA          NA  setosa TRUE</span></span>
<span id="cb12-12"><a href="#cb12-12"></a><span class="co">#&gt; 5           NA          NA          1.4         0.2  setosa TRUE</span></span>
<span id="cb12-13"><a href="#cb12-13"></a><span class="co">#&gt; 6           NA         3.9          1.7         0.4  setosa TRUE</span></span>
<span id="cb12-14"><a href="#cb12-14"></a><span class="co">#&gt;                    dt          d     ch</span></span>
<span id="cb12-15"><a href="#cb12-15"></a><span class="co">#&gt; 1 2019-06-30 22:32:39 2019-06-30 setosa</span></span>
<span id="cb12-16"><a href="#cb12-16"></a><span class="co">#&gt; 2 2019-06-30 22:33:39 2019-07-01 setosa</span></span>
<span id="cb12-17"><a href="#cb12-17"></a><span class="co">#&gt; 3 2019-06-30 22:34:39 2019-07-02 setosa</span></span>
<span id="cb12-18"><a href="#cb12-18"></a><span class="co">#&gt; 4 2019-06-30 22:35:39 2019-07-03 setosa</span></span>
<span id="cb12-19"><a href="#cb12-19"></a><span class="co">#&gt; 5                &lt;NA&gt; 2019-07-04 setosa</span></span>
<span id="cb12-20"><a href="#cb12-20"></a><span class="co">#&gt; 6 2019-06-30 22:37:39 2019-07-05 setosa</span></span>
<span id="cb12-21"><a href="#cb12-21"></a><span class="kw">head</span>(m &lt;-<span class="st"> </span><span class="kw">missRanger</span>(ir, <span class="dt">pmm.k =</span> <span class="dv">4</span>))</span>
<span id="cb12-22"><a href="#cb12-22"></a><span class="co">#&gt; </span></span>
<span id="cb12-23"><a href="#cb12-23"></a><span class="co">#&gt; Missing value imputation by random forests</span></span>
<span id="cb12-24"><a href="#cb12-24"></a><span class="co">#&gt; </span></span>
<span id="cb12-25"><a href="#cb12-25"></a><span class="co">#&gt;   Variables to impute:       Sepal.Length, Sepal.Width, Petal.Length, Petal.Width, Species, s, dt</span></span>
<span id="cb12-26"><a href="#cb12-26"></a><span class="co">#&gt;   Variables used to impute:  Sepal.Length, Sepal.Width, Petal.Length, Petal.Width, Species, s, dt, d, ch</span></span>
<span id="cb12-27"><a href="#cb12-27"></a><span class="co">#&gt; iter 1:  .......</span></span>
<span id="cb12-28"><a href="#cb12-28"></a><span class="co">#&gt; iter 2:  .......</span></span>
<span id="cb12-29"><a href="#cb12-29"></a><span class="co">#&gt; iter 3:  .......</span></span>
<span id="cb12-30"><a href="#cb12-30"></a><span class="co">#&gt; iter 4:  .......</span></span>
<span id="cb12-31"><a href="#cb12-31"></a><span class="co">#&gt; iter 5:  .......</span></span>
<span id="cb12-32"><a href="#cb12-32"></a><span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species    s</span></span>
<span id="cb12-33"><a href="#cb12-33"></a><span class="co">#&gt; 1          5.1         3.5          1.4         0.2  setosa TRUE</span></span>
<span id="cb12-34"><a href="#cb12-34"></a><span class="co">#&gt; 2          4.9         3.0          1.4         0.1  setosa TRUE</span></span>
<span id="cb12-35"><a href="#cb12-35"></a><span class="co">#&gt; 3          4.7         3.2          1.3         0.2  setosa TRUE</span></span>
<span id="cb12-36"><a href="#cb12-36"></a><span class="co">#&gt; 4          4.6         3.1          1.3         0.2  setosa TRUE</span></span>
<span id="cb12-37"><a href="#cb12-37"></a><span class="co">#&gt; 5          4.4         3.3          1.4         0.2  setosa TRUE</span></span>
<span id="cb12-38"><a href="#cb12-38"></a><span class="co">#&gt; 6          5.1         3.9          1.7         0.4  setosa TRUE</span></span>
<span id="cb12-39"><a href="#cb12-39"></a><span class="co">#&gt;                    dt          d     ch</span></span>
<span id="cb12-40"><a href="#cb12-40"></a><span class="co">#&gt; 1 2019-06-30 22:32:39 2019-06-30 setosa</span></span>
<span id="cb12-41"><a href="#cb12-41"></a><span class="co">#&gt; 2 2019-06-30 22:33:39 2019-07-01 setosa</span></span>
<span id="cb12-42"><a href="#cb12-42"></a><span class="co">#&gt; 3 2019-06-30 22:34:39 2019-07-02 setosa</span></span>
<span id="cb12-43"><a href="#cb12-43"></a><span class="co">#&gt; 4 2019-06-30 22:35:39 2019-07-03 setosa</span></span>
<span id="cb12-44"><a href="#cb12-44"></a><span class="co">#&gt; 5 2019-06-30 22:32:39 2019-07-04 setosa</span></span>
<span id="cb12-45"><a href="#cb12-45"></a><span class="co">#&gt; 6 2019-06-30 22:37:39 2019-07-05 setosa</span></span></code></pre></div>
</div>
</div>
<div id="references" class="section level2">
<h2>References</h2>
<p>[1] Wright, M. N. &amp; Ziegler, A. (2016). ranger: A Fast Implementation of Random Forests for High Dimensional Data in C++ and R. Journal of Statistical Software, in press. <a href="http://arxiv.org/abs/1508.04409" class="uri">http://arxiv.org/abs/1508.04409</a>.</p>
<p>[2] Stekhoven, D.J. and Buehlmann, P. (2012). MissForest - nonparametric missing value imputation for mixed-type data. Bioinformatics, 28(1), 112-118.</p>
<p>[3] Van Buuren, S. and Groothuis-Oudshoorn, K. (2011). mice: Multivariate Imputation by Chained Equations in R. Journal of Statistical Software, 45(3), 1-67. <a href="http://www.jstatsoft.org/v45/i03/" class="uri">http://www.jstatsoft.org/v45/i03/</a></p>
<p>[4] Rubin, D.B. (1987). <em>Multiple Imputation for Nonresponse in Surveys.</em> New York: John Wiley and Sons.</p>
<p>[5] White IR and Royston P. (2009). Imputing missing covariate values for the Cox model. Statistics in medicine, 28(15), 1982-1998.</p>
</div>



<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
